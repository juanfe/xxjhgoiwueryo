import StringIO
import csv
import random
import logging
from google.appengine.api import users, memcache
from google.appengine.ext import webapp
from google.appengine.ext.webapp import template
from google.appengine.ext.webapp.util import run_wsgi_app
from django.utils import simplejson as json
from datetime import datetime, timedelta, date
from ls.model import user, bid
from ls.model.bid import Bid
from ls.model.user import User
from ls.model.user import PageAllowed, getGroup, getCurrentUser, getPageDict, getTheUser
from ls.model.page import Page
from model import loansModel
from calc import calc
import logging

#Rendering logic


class Home(webapp.RequestHandler):
    @PageAllowed(['Admin']) #, 'Broker', 'MO', 'Engine'])
    def get(self):
        page = Page.HOME
        parameters = getPageDict(page)
        parameters['User'] = "%s %s" % (getCurrentUser(), getGroup())
        self.response.out.write(template.render("templates/home.html",
                parameters))


class Search(webapp.RequestHandler):
    @PageAllowed(['Admin', 'Broker', 'MO', 'Engine'])
    def get(self):
        page = Page.SEARCH
        parameters = getPageDict(page)
        parameters['User'] = "%s %s" % (getCurrentUser(), getGroup())
        self.response.out.write(template.render("templates/search.html",
                parameters))


class Calc(webapp.RequestHandler):
    @PageAllowed(['Admin', 'Engine'])
    def get(self):
        try:
            page = Page.CALC
            parameters = getPageDict(page)
            parameters['User'] = "%s %s" % (getCurrentUser(), getGroup())
            c = calc()
            if 'loans' in c and 'bids' in c:
                parameters['loans'] = c['loans']
                parameters['bids'] = c['bids']
            for i in range(1, len(c['bids'])):
                b = Bid.get_by_key_name(key_names = c['bids'][i][0]['bid'])
                logging.debug("c['bids'][i][0] = " + 80 * "#")
                logging.debug(c['bids'][i][0]['bid'])
                logging.debug(i)
                logging.debug(80 * "#")
                for j in range(len(c['bids'][i])):
                    if 'key' in c['bids'][i][j]:
                        l = loansModel.getLoan(c['bids'][i][j]['key'])
                        l.curr_upb -= long(c['bids'][i][j]['key'])
                        l.put()
                b.status = 'Accepted'
                b.put()
            self.response.out.write(template.render("templates/results.html",
                    parameters))
        except:
            #TODO Remove the hardcode as soon calc work
            page = Page.CALC
            parameters = getPageDict(page)
            parameters['User'] = "%s %s" % (getCurrentUser(), getGroup())
            parameters['loans'] = [u'201149215', u'201149597', u'201149168',
                    u'201148342', u'201149456', u'201147544', u'201148832',
                    u'201148834', u'201149167', u'201149289', u'201149284',
                    u'201150096', u'201149204', u'201149047', u'201147653',
                    u'201149687', u'201149257', u'201149444', u'201150008',
                    u'201149579', u'201148009', u'201149471', u'201149935',
                    u'201149441', u'201149846', u'201149778', u'201149565',
                    u'201149560', u'201149562', u'201148993', u'201146570',
                    u'201147482', u'201149372', u'201149374', u'201149875',
                    u'201149988', u'201149905', u'201145735', u'201149703',
                    u'201149669', u'201149577', u'201148154', u'201149578',
                    u'201149477', u'201149269', u'201149664', u'201149063',
                    u'201144387', u'201149991', u'201147776', u'201149154',
                    u'201149912', u'201149712', u'201148780', u'201149469',
                    u'201149544', u'201149541', u'201149462', u'201149652',
                    u'201149396', u'201149077', u'201149253', u'201148544',
                    u'201145759', u'201148972', u'201148639', u'201148539',
                    u'201149321', u'201149241', u'201148530', u'201148886',
                    u'201149976', u'201145234', u'201150125', u'201147140',
                    u'201147282', u'201149733', u'201146741', u'201150040',
                    u'201148440', u'201149336', u'201144944', u'201147471',
                    u'201148956', u'201149534', u'201149741', u'201149940',
                    u'201149622', u'201148329', u'201145114', u'201149229',
                    u'201149582', u'201149828', u'201149589', u'201148353',
                    u'201145359', u'201149474', u'201148589', u'201149751',
                    u'201149359']
            parameters['bids'] = [[{'bid': u'3:00:00 PM 1104134'},
                    {'key': u'201149215', 'val': '50463.96'},
                    {'key': u'201149597', 'val': '26401.46'},
                    {'key': u'201149168', 'val': '10893.81'},
                    {'key': u'201148342', 'val': '29221.04'},
                    {'key': u'201149456', 'val': '22043.94'},
                    {'key': u'201147544', 'val': '37256.82'},
                    {'key': u'201148832', 'val': '66935.27'},
                    {'key': u'201148834', 'val': '29221.04'},
                    {'key': u'201149167', 'val': '18070.90'},
                    {'key': u'201149289', 'val': '42293.61'},
                    {'key': u'201149284', 'val': '27170.44'},
                    {'key': u'201150096', 'val': '21274.97'},
                    {'key': u'201149204', 'val': '39986.68'},
                    {'key': u'201149047', 'val': '25376.16'},
                    {'key': u'201147653', 'val': '40243.01'},
                    {'key': u'201149687', 'val': '51521.30'},
                    {'key': u'201149257', 'val': '22428.43'},
                    {'key': u'201149444', 'val': '80165.61'},
                    {'key': u'201150008', 'val': '29477.36'},
                    {'key': u'201149579', 'val': '130982.02'},
                    {'key': u'201148009', 'val': '35885.48'},
                    {'key': u'201149471', 'val': '22877.00'},
                    {'key': u'201149935', 'val': '27683.09'},
                    {'key': u'201149441', 'val': '23710.05'},
                    {'key': u'201149846', 'val': '51264.98'},
                    {'key': u'201149778', 'val': '12816.24'},
                    {'key': u'201149565', 'val': '42293.61'},
                    {'key': u'201149560', 'val': '30758.99'},
                    {'key': u'201149562', 'val': '160203.05'},
                    {'key': u'201148993', 'val': '64593.87'},
                    {'key': u'201146570', 'val': '58698.40'},
                    {'key': u'201147482', 'val': '53443.74'},
                    {'key': u'201149372', 'val': '52546.60'},
                    {'key': u'201149374', 'val': '37497.13'},
                    {'key': u'201149875', 'val': '51713.55'},
                    {'key': u'201149988', 'val': '27811.25'},
                    {'key': u'201149905', 'val': '25747.83'},
                    {'key': u'201145735', 'val': '32681.42'},
                    {'key': u'201149703', 'val': '78960.88'},
                    {'key': u'201149669', 'val': '25837.55'},
                    {'key': u'201149577', 'val': '16276.63'},
                    {'key': u'201148154', 'val': '34603.86'},
                    {'key': u'201149578', 'val': '110540.11'},
                    {'key': u'201149477', 'val': '74948.11'},
                    {'key': u'201149269', 'val': '17487.89'},
                    {'key': u'201149664', 'val': '36099.90'},
                    {'key': u'201149063', 'val': '28580.22'},
                    {'key': u'201144387', 'val': '52338.72'},
                    {'key': u'201149991', 'val': '20505.99'},
                    {'key': u'201147776', 'val': '41934.75'},
                    {'key': u'201149154', 'val': '34347.53'},
                    {'key': u'201149912', 'val': '29733.69'},
                    {'key': u'201149712', 'val': '17327.56'},
                    {'key': u'201148780', 'val': '37807.92'},
                    {'key': u'201149469', 'val': '29861.85'},
                    {'key': u'201149544', 'val': '41011.98'},
                    {'key': u'201149541', 'val': '32040.61'},
                    {'key': u'201149462', 'val': '62197.23'},
                    {'key': u'201149652', 'val': '31852.85'},
                    {'key': u'201149396', 'val': '22915.44'},
                    {'key': u'201149077', 'val': '28212.78'},
                    {'key': u'201149253', 'val': '33834.88'},
                    {'key': u'201148544', 'val': '32809.59'},
                    {'key': u'201145759', 'val': '53443.74'},
                    {'key': u'201148972', 'val': '33322.23'},
                    {'key': u'201148639', 'val': '24222.70'},
                    {'key': u'201148539', 'val': '44968.87'},
                    {'key': u'201149321', 'val': '24094.54'},
                    {'key': u'201149241', 'val': '37679.76'},
                    {'key': u'201148530', 'val': '28900.63'},
                    {'key': u'201148886', 'val': '30887.15'},
                    {'key': u'201149976', 'val': '12816.24'},
                    {'key': u'201145234', 'val': '80165.61'},
                    {'key': u'201150125', 'val': '50496.00'},
                    {'key': u'201147140', 'val': '18871.92'},
                    {'key': u'201147282', 'val': '61326.63'},
                    {'key': u'201149733', 'val': '37167.11'},
                    {'key': u'201146741', 'val': '32040.61'},
                    {'key': u'201150040', 'val': '46907.45'},
                    {'key': u'201148440', 'val': '48060.92'},
                    {'key': u'201149336', 'val': '12303.59'},
                    {'key': u'201144944', 'val': '46138.48'},
                    {'key': u'201147471', 'val': '38576.89'},
                    {'key': u'201148956', 'val': '5126.50'},
                    {'key': u'201149534', 'val': '23710.05'},
                    {'key': u'201149741', 'val': '53443.74'},
                    {'key': u'201149940', 'val': '45301.71'},
                    {'key': u'201149622', 'val': '34667.94'},
                    {'key': u'201148329', 'val': '12130.58'},
                    {'key': u'201145114', 'val': '33322.23'},
                    {'key': u'201149229', 'val': '33104.36'},
                    {'key': u'201149582', 'val': '34283.45'},
                    {'key': u'201149828', 'val': '15763.98'},
                    {'key': u'201149589', 'val': '25632.49'},
                    {'key': u'201148353', 'val': '19480.69'},
                    {'key': u'201145359', 'val': '35885.48'},
                    {'key': u'201149474', 'val': '38961.38'},
                    {'key': u'201148589', 'val': '51649.46'},
                    {'key': u'201149751', 'val': '102779.87'},
                    {'key': u'201149359', 'val': '30989.68'}],
                    [{'bid': u'7:59:00 PM 1104140'},
                    {'key': u'201149215', 'val': 0},
                    {'key': u'201149597', 'val': 0},
                    {'key': u'201149168', 'val': 0},
                    {'key': u'201148342', 'val': 0},
                    {'key': u'201149456', 'val': 0},
                    {'key': u'201147544', 'val': 0},
                    {'key': u'201148832', 'val': 0},
                    {'key': u'201148834', 'val': 0},
                    {'key': u'201149167', 'val': 0},
                    {'key': u'201149289', 'val': 0},
                    {'key': u'201149284', 'val': 0},
                    {'key': u'201150096', 'val': 0},
                    {'key': u'201149204', 'val': 0},
                    {'key': u'201149047', 'val': 0},
                    {'key': u'201147653', 'val': 0},
                    {'key': u'201149687', 'val': 0},
                    {'key': u'201149257', 'val': 0},
                    {'key': u'201149444', 'val': 0},
                    {'key': u'201150008', 'val': 0},
                    {'key': u'201149579', 'val': 0},
                    {'key': u'201148009', 'val': 0},
                    {'key': u'201149471', 'val': 0},
                    {'key': u'201149935', 'val': 0},
                    {'key': u'201149441', 'val': 0},
                    {'key': u'201149846', 'val': 0},
                    {'key': u'201149778', 'val': 0},
                    {'key': u'201149565', 'val': 0},
                    {'key': u'201149560', 'val': 0},
                    {'key': u'201149562', 'val': 0},
                    {'key': u'201148993', 'val': 0},
                    {'key': u'201146570', 'val': 0},
                    {'key': u'201147482', 'val': 0},
                    {'key': u'201149372', 'val': 0},
                    {'key': u'201149374', 'val': 0},
                    {'key': u'201149875', 'val': 0},
                    {'key': u'201149988', 'val': 0},
                    {'key': u'201149905', 'val': 0},
                    {'key': u'201145735', 'val': 0},
                    {'key': u'201149703', 'val': 0},
                    {'key': u'201149669', 'val': 0},
                    {'key': u'201149577', 'val': 0},
                    {'key': u'201148154', 'val': 0},
                    {'key': u'201149578', 'val': 0},
                    {'key': u'201149477', 'val': 0},
                    {'key': u'201149269', 'val': 0},
                    {'key': u'201149664', 'val': 0},
                    {'key': u'201149063', 'val': 0},
                    {'key': u'201144387', 'val': 0},
                    {'key': u'201149991', 'val': 0},
                    {'key': u'201147776', 'val': 0},
                    {'key': u'201149154', 'val': 0},
                    {'key': u'201149912', 'val': 0},
                    {'key': u'201149712', 'val': 0},
                    {'key': u'201148780', 'val': 0},
                    {'key': u'201149469', 'val': 0},
                    {'key': u'201149544', 'val': 0},
                    {'key': u'201149541', 'val': 0},
                    {'key': u'201149462', 'val': 0},
                    {'key': u'201149652', 'val': 0},
                    {'key': u'201149396', 'val': 0},
                    {'key': u'201149077', 'val': 0},
                    {'key': u'201149253', 'val': 0},
                    {'key': u'201148544', 'val': 0},
                    {'key': u'201145759', 'val': 0},
                    {'key': u'201148972', 'val': 0},
                    {'key': u'201148639', 'val': 0},
                    {'key': u'201148539', 'val': 0},
                    {'key': u'201149321', 'val': 0},
                    {'key': u'201149241', 'val': 0},
                    {'key': u'201148530', 'val': 0},
                    {'key': u'201148886', 'val': 0},
                    {'key': u'201149976', 'val': 0},
                    {'key': u'201145234', 'val': 0},
                    {'key': u'201150125', 'val': 0},
                    {'key': u'201147140', 'val': 0},
                    {'key': u'201147282', 'val': 0},
                    {'key': u'201149733', 'val': 0},
                    {'key': u'201146741', 'val': 0},
                    {'key': u'201150040', 'val': 0},
                    {'key': u'201148440', 'val': '74000.00'},
                    {'key': u'201149336', 'val': 0},
                    {'key': u'201144944', 'val': 0},
                    {'key': u'201147471', 'val': 0},
                    {'key': u'201148956', 'val': 0},
                    {'key': u'201149534', 'val': 0},
                    {'key': u'201149741', 'val': 0},
                    {'key': u'201149940', 'val': 0},
                    {'key': u'201149622', 'val': 0},
                    {'key': u'201148329', 'val': 0},
                    {'key': u'201145114', 'val': 0},
                    {'key': u'201149229', 'val': 0},
                    {'key': u'201149582', 'val': 0},
                    {'key': u'201149828', 'val': 0},
                    {'key': u'201149589', 'val': 0},
                    {'key': u'201148353', 'val': 0},
                    {'key': u'201145359', 'val': 0},
                    {'key': u'201149474', 'val': 0},
                    {'key': u'201148589', 'val': 0},
                    {'key': u'201149751', 'val': 0},
                    {'key': u'201149359', 'val': 0}],
                    [{'bid': u'3:00:00 PM 1104154'},
                    {'key': u'201149215', 'val': '2366.89'},
                    {'key': u'201149597', 'val': '1238.30'},
                    {'key': u'201149168', 'val': '510.95'},
                    {'key': u'201148342', 'val': '1370.54'},
                    {'key': u'201149456', 'val': '1033.92'},
                    {'key': u'201147544', 'val': '1747.44'},
                    {'key': u'201148832', 'val': '3139.44'},
                    {'key': u'201148834', 'val': '1370.54'},
                    {'key': u'201149167', 'val': '847.57'},
                    {'key': u'201149289', 'val': '1983.68'},
                    {'key': u'201149284', 'val': '1274.36'},
                    {'key': u'201150096', 'val': '997.85'},
                    {'key': u'201149204', 'val': '1875.48'},
                    {'key': u'201149047', 'val': '1190.21'},
                    {'key': u'201147653', 'val': '1887.50'},
                    {'key': u'201149687', 'val': '2416.48'},
                    {'key': u'201149257', 'val': '1051.95'},
                    {'key': u'201149444', 'val': '3759.97'},
                    {'key': u'201150008', 'val': '1382.56'},
                    {'key': u'201149579', 'val': '6143.39'},
                    {'key': u'201148009', 'val': '1683.12'},
                    {'key': u'201149471', 'val': '1072.99'},
                    {'key': u'201149935', 'val': '1298.41'},
                    {'key': u'201149441', 'val': '1112.06'},
                    {'key': u'201149846', 'val': '2404.46'},
                    {'key': u'201149778', 'val': '601.11'},
                    {'key': u'201149565', 'val': '1983.68'},
                    {'key': u'201149560', 'val': '1442.68'},
                    {'key': u'201149562', 'val': '7513.93'},
                    {'key': u'201148993', 'val': '3029.62'},
                    {'key': u'201146570', 'val': '2753.11'},
                    {'key': u'201147482', 'val': '2506.65'},
                    {'key': u'201149372', 'val': '2464.57'},
                    {'key': u'201149374', 'val': '1758.71'},
                    {'key': u'201149875', 'val': '2425.50'},
                    {'key': u'201149988', 'val': '1304.42'},
                    {'key': u'201149905', 'val': '1207.64'},
                    {'key': u'201145735', 'val': '1532.84'},
                    {'key': u'201149703', 'val': '3703.47'},
                    {'key': u'201149669', 'val': '1211.85'},
                    {'key': u'201149577', 'val': '763.42'},
                    {'key': u'201148154', 'val': '1623.01'},
                    {'key': u'201149578', 'val': '5184.61'},
                    {'key': u'201149477', 'val': '3515.26'},
                    {'key': u'201149269', 'val': '820.23'},
                    {'key': u'201149664', 'val': '1693.18'},
                    {'key': u'201149063', 'val': '1340.49'},
                    {'key': u'201144387', 'val': '2454.82'},
                    {'key': u'201149991', 'val': '961.78'},
                    {'key': u'201147776', 'val': '1966.85'},
                    {'key': u'201149154', 'val': '1610.99'},
                    {'key': u'201149912', 'val': '1394.59'},
                    {'key': u'201149712', 'val': '812.71'},
                    {'key': u'201148780', 'val': '1773.29'},
                    {'key': u'201149469', 'val': '1400.60'},
                    {'key': u'201149544', 'val': '1923.57'},
                    {'key': u'201149541', 'val': '1502.79'},
                    {'key': u'201149462', 'val': '2917.21'},
                    {'key': u'201149652', 'val': '1493.98'},
                    {'key': u'201149396', 'val': '1074.79'},
                    {'key': u'201149077', 'val': '1323.25'},
                    {'key': u'201149253', 'val': '1586.94'},
                    {'key': u'201148544', 'val': '1538.85'},
                    {'key': u'201145759', 'val': '2506.65'},
                    {'key': u'201148972', 'val': '1562.90'},
                    {'key': u'201148639', 'val': '1136.11'},
                    {'key': u'201148539', 'val': '2109.16'},
                    {'key': u'201149321', 'val': '1130.10'},
                    {'key': u'201149241', 'val': '1767.28'},
                    {'key': u'201148530', 'val': '1355.51'},
                    {'key': u'201148886', 'val': '1448.69'},
                    {'key': u'201149976', 'val': '601.11'},
                    {'key': u'201145234', 'val': '3759.97'},
                    {'key': u'201150125', 'val': '2368.39'},
                    {'key': u'201147140', 'val': '885.14'},
                    {'key': u'201147282', 'val': '2876.38'},
                    {'key': u'201149733', 'val': '1743.23'},
                    {'key': u'201146741', 'val': '1502.79'},
                    {'key': u'201150040', 'val': '2200.08'},
                    {'key': u'201148440', 'val': '2254.18'},
                    {'key': u'201149336', 'val': '577.07'},
                    {'key': u'201144944', 'val': '2164.01'},
                    {'key': u'201147471', 'val': '1809.36'},
                    {'key': u'201148956', 'val': '240.45'},
                    {'key': u'201149534', 'val': '1112.06'},
                    {'key': u'201149741', 'val': '2506.65'},
                    {'key': u'201149940', 'val': '2124.77'},
                    {'key': u'201149622', 'val': '1626.02'},
                    {'key': u'201148329', 'val': '568.96'},
                    {'key': u'201145114', 'val': '1562.90'},
                    {'key': u'201149229', 'val': '1552.68'},
                    {'key': u'201149582', 'val': '1607.98'},
                    {'key': u'201149828', 'val': '739.37'},
                    {'key': u'201149589', 'val': '1202.23'},
                    {'key': u'201148353', 'val': '913.69'},
                    {'key': u'201145359', 'val': '1683.12'},
                    {'key': u'201149474', 'val': '1827.39'},
                    {'key': u'201148589', 'val': '2422.49'},
                    {'key': u'201149751', 'val': '4820.64'},
                    {'key': u'201149359', 'val': '1453.50'}],
                    [{'bid': u'8:56:36 AM 1104158'},
                    {'key': u'201149215', 'val': 0},
                    {'key': u'201149597', 'val': 0},
                    {'key': u'201149168', 'val': 0},
                    {'key': u'201148342', 'val': 0},
                    {'key': u'201149456', 'val': 0},
                    {'key': u'201147544', 'val': 0},
                    {'key': u'201148832', 'val': 0},
                    {'key': u'201148834', 'val': 0},
                    {'key': u'201149167', 'val': 0},
                    {'key': u'201149289', 'val': 0},
                    {'key': u'201149284', 'val': 0},
                    {'key': u'201150096', 'val': 0},
                    {'key': u'201149204', 'val': 0},
                    {'key': u'201149047', 'val': 0},
                    {'key': u'201147653', 'val': 0},
                    {'key': u'201149687', 'val': 0},
                    {'key': u'201149257', 'val': 0},
                    {'key': u'201149444', 'val': 0},
                    {'key': u'201150008', 'val': 0},
                    {'key': u'201149579', 'val': 0},
                    {'key': u'201148009', 'val': 0},
                    {'key': u'201149471', 'val': 0},
                    {'key': u'201149935', 'val': 0},
                    {'key': u'201149441', 'val': 0},
                    {'key': u'201149846', 'val': 0},
                    {'key': u'201149778', 'val': 0},
                    {'key': u'201149565', 'val': 0},
                    {'key': u'201149560', 'val': 0},
                    {'key': u'201149562', 'val': 0},
                    {'key': u'201148993', 'val': 0},
                    {'key': u'201146570', 'val': 0},
                    {'key': u'201147482', 'val': 0},
                    {'key': u'201149372', 'val': 0},
                    {'key': u'201149374', 'val': 0},
                    {'key': u'201149875', 'val': 0},
                    {'key': u'201149988', 'val': 0},
                    {'key': u'201149905', 'val': 0},
                    {'key': u'201145735', 'val': 0},
                    {'key': u'201149703', 'val': 0},
                    {'key': u'201149669', 'val': 0},
                    {'key': u'201149577', 'val': 0},
                    {'key': u'201148154', 'val': 0},
                    {'key': u'201149578', 'val': 0},
                    {'key': u'201149477', 'val': 0},
                    {'key': u'201149269', 'val': 0},
                    {'key': u'201149664', 'val': 0},
                    {'key': u'201149063', 'val': 0},
                    {'key': u'201144387', 'val': 0},
                    {'key': u'201149991', 'val': 0},
                    {'key': u'201147776', 'val': 0},
                    {'key': u'201149154', 'val': 0},
                    {'key': u'201149912', 'val': 0},
                    {'key': u'201149712', 'val': 0},
                    {'key': u'201148780', 'val': 0},
                    {'key': u'201149469', 'val': 0},
                    {'key': u'201149544', 'val': 0},
                    {'key': u'201149541', 'val': 0},
                    {'key': u'201149462', 'val': 0},
                    {'key': u'201149652', 'val': 0},
                    {'key': u'201149396', 'val': 0},
                    {'key': u'201149077', 'val': 0},
                    {'key': u'201149253', 'val': 0},
                    {'key': u'201148544', 'val': 0},
                    {'key': u'201145759', 'val': 0},
                    {'key': u'201148972', 'val': 0},
                    {'key': u'201148639', 'val': 0},
                    {'key': u'201148539', 'val': 0},
                    {'key': u'201149321', 'val': 0},
                    {'key': u'201149241', 'val': 0},
                    {'key': u'201148530', 'val': 0},
                    {'key': u'201148886', 'val': 0},
                    {'key': u'201149976', 'val': 0},
                    {'key': u'201145234', 'val': 0},
                    {'key': u'201150125', 'val': 0},
                    {'key': u'201147140', 'val': 0},
                    {'key': u'201147282', 'val': 0},
                    {'key': u'201149733', 'val': 0},
                    {'key': u'201146741', 'val': 0},
                    {'key': u'201150040', 'val': 0},
                    {'key': u'201148440', 'val': 0},
                    {'key': u'201149336', 'val': 0},
                    {'key': u'201144944', 'val': 0},
                    {'key': u'201147471', 'val': 0},
                    {'key': u'201148956', 'val': 0},
                    {'key': u'201149534', 'val': 0},
                    {'key': u'201149741', 'val': 0},
                    {'key': u'201149940', 'val': 0},
                    {'key': u'201149622', 'val': 0},
                    {'key': u'201148329', 'val': '63100.00'},
                    {'key': u'201145114', 'val': 0},
                    {'key': u'201149229', 'val': 0},
                    {'key': u'201149582', 'val': 0},
                    {'key': u'201149828', 'val': 0},
                    {'key': u'201149589', 'val': 0},
                    {'key': u'201148353', 'val': 0},
                    {'key': u'201145359', 'val': 0},
                    {'key': u'201149474', 'val': 0},
                    {'key': u'201148589', 'val': 0},
                    {'key': u'201149751', 'val': 0},
                    {'key': u'201149359', 'val': 0}],
                    [{'bid': u'2:27:48 AM 1104149'},
                    {'key': u'201149215', 'val': 0},
                    {'key': u'201149597', 'val': 0},
                    {'key': u'201149168', 'val': 0},
                    {'key': u'201148342', 'val': 0},
                    {'key': u'201149456', 'val': 0},
                    {'key': u'201147544', 'val': 0},
                    {'key': u'201148832', 'val': 0},
                    {'key': u'201148834', 'val': 0},
                    {'key': u'201149167', 'val': 0},
                    {'key': u'201149289', 'val': 0},
                    {'key': u'201149284', 'val': 0},
                    {'key': u'201150096', 'val': 0},
                    {'key': u'201149204', 'val': 0},
                    {'key': u'201149047', 'val': 0},
                    {'key': u'201147653', 'val': 0},
                    {'key': u'201149687', 'val': 0},
                    {'key': u'201149257', 'val': 0},
                    {'key': u'201149444', 'val': 0},
                    {'key': u'201150008', 'val': 0},
                    {'key': u'201149579', 'val': 0},
                    {'key': u'201148009', 'val': 0},
                    {'key': u'201149471', 'val': 0},
                    {'key': u'201149935', 'val': 0},
                    {'key': u'201149441', 'val': 0},
                    {'key': u'201149846', 'val': 0},
                    {'key': u'201149778', 'val': 0},
                    {'key': u'201149565', 'val': 0},
                    {'key': u'201149560', 'val': 0},
                    {'key': u'201149562', 'val': 0},
                    {'key': u'201148993', 'val': 0},
                    {'key': u'201146570', 'val': 0},
                    {'key': u'201147482', 'val': 0},
                    {'key': u'201149372', 'val': 0},
                    {'key': u'201149374', 'val': 0},
                    {'key': u'201149875', 'val': 0},
                    {'key': u'201149988', 'val': 0},
                    {'key': u'201149905', 'val': 0},
                    {'key': u'201145735', 'val': 0},
                    {'key': u'201149703', 'val': 0},
                    {'key': u'201149669', 'val': 0},
                    {'key': u'201149577', 'val': 0},
                    {'key': u'201148154', 'val': 0},
                    {'key': u'201149578', 'val': 0},
                    {'key': u'201149477', 'val': 0},
                    {'key': u'201149269', 'val': 0},
                    {'key': u'201149664', 'val': 0},
                    {'key': u'201149063', 'val': 0},
                    {'key': u'201144387', 'val': 0},
                    {'key': u'201149991', 'val': 0},
                    {'key': u'201147776', 'val': 0},
                    {'key': u'201149154', 'val': 0},
                    {'key': u'201149912', 'val': 0},
                    {'key': u'201149712', 'val': 0},
                    {'key': u'201148780', 'val': 0},
                    {'key': u'201149469', 'val': 0},
                    {'key': u'201149544', 'val': 0},
                    {'key': u'201149541', 'val': 0},
                    {'key': u'201149462', 'val': 0},
                    {'key': u'201149652', 'val': 0},
                    {'key': u'201149396', 'val': 0},
                    {'key': u'201149077', 'val': 0},
                    {'key': u'201149253', 'val': 0},
                    {'key': u'201148544', 'val': 0},
                    {'key': u'201145759', 'val': 0},
                    {'key': u'201148972', 'val': 0},
                    {'key': u'201148639', 'val': 0},
                    {'key': u'201148539', 'val': 0},
                    {'key': u'201149321', 'val': 0},
                    {'key': u'201149241', 'val': 0},
                    {'key': u'201148530', 'val': 0},
                    {'key': u'201148886', 'val': 0},
                    {'key': u'201149976', 'val': 0},
                    {'key': u'201145234', 'val': 0},
                    {'key': u'201150125', 'val': 0},
                    {'key': u'201147140', 'val': 0},
                    {'key': u'201147282', 'val': 0},
                    {'key': u'201149733', 'val': 0},
                    {'key': u'201146741', 'val': 0},
                    {'key': u'201150040', 'val': 0},
                    {'key': u'201148440', 'val': '47000.00'},
                    {'key': u'201149336', 'val': 0},
                    {'key': u'201144944', 'val': 0},
                    {'key': u'201147471', 'val': 0},
                    {'key': u'201148956', 'val': 0},
                    {'key': u'201149534', 'val': 0},
                    {'key': u'201149741', 'val': 0},
                    {'key': u'201149940', 'val': 0},
                    {'key': u'201149622', 'val': 0},
                    {'key': u'201148329', 'val': 0},
                    {'key': u'201145114', 'val': 0},
                    {'key': u'201149229', 'val': 0},
                    {'key': u'201149582', 'val': 0},
                    {'key': u'201149828', 'val': 0},
                    {'key': u'201149589', 'val': 0},
                    {'key': u'201148353', 'val': 0},
                    {'key': u'201145359', 'val': 0},
                    {'key': u'201149474', 'val': 0},
                    {'key': u'201148589', 'val': 0},
                    {'key': u'201149751', 'val': 0},
                    {'key': u'201149359', 'val': 0}],
                    [{'bid': u'3:54:12 AM 1104151'},
                    {'key': u'201149215', 'val': 0},
                    {'key': u'201149597', 'val': 0},
                    {'key': u'201149168', 'val': 0},
                    {'key': u'201148342', 'val': 0},
                    {'key': u'201149456', 'val': 0},
                    {'key': u'201147544', 'val': 0},
                    {'key': u'201148832', 'val': 0},
                    {'key': u'201148834', 'val': 0},
                    {'key': u'201149167', 'val': 0},
                    {'key': u'201149289', 'val': 0},
                    {'key': u'201149284', 'val': 0},
                    {'key': u'201150096', 'val': 0},
                    {'key': u'201149204', 'val': 0},
                    {'key': u'201149047', 'val': 0},
                    {'key': u'201147653', 'val': 0},
                    {'key': u'201149687', 'val': 0},
                    {'key': u'201149257', 'val': 0},
                    {'key': u'201149444', 'val': 0},
                    {'key': u'201150008', 'val': 0},
                    {'key': u'201149579', 'val': 0},
                    {'key': u'201148009', 'val': 0},
                    {'key': u'201149471', 'val': 0},
                    {'key': u'201149935', 'val': 0},
                    {'key': u'201149441', 'val': 0},
                    {'key': u'201149846', 'val': 0},
                    {'key': u'201149778', 'val': 0},
                    {'key': u'201149565', 'val': 0},
                    {'key': u'201149560', 'val': 0},
                    {'key': u'201149562', 'val': 0},
                    {'key': u'201148993', 'val': 0},
                    {'key': u'201146570', 'val': 0},
                    {'key': u'201147482', 'val': 0},
                    {'key': u'201149372', 'val': 0},
                    {'key': u'201149374', 'val': 0},
                    {'key': u'201149875', 'val': 0},
                    {'key': u'201149988', 'val': 0},
                    {'key': u'201149905', 'val': 0},
                    {'key': u'201145735', 'val': 0},
                    {'key': u'201149703', 'val': 0},
                    {'key': u'201149669', 'val': 0},
                    {'key': u'201149577', 'val': 0},
                    {'key': u'201148154', 'val': 0},
                    {'key': u'201149578', 'val': 0},
                    {'key': u'201149477', 'val': 0},
                    {'key': u'201149269', 'val': 0},
                    {'key': u'201149664', 'val': 0},
                    {'key': u'201149063', 'val': 0},
                    {'key': u'201144387', 'val': 0},
                    {'key': u'201149991', 'val': 0},
                    {'key': u'201147776', 'val': 0},
                    {'key': u'201149154', 'val': 0},
                    {'key': u'201149912', 'val': 0},
                    {'key': u'201149712', 'val': 0},
                    {'key': u'201148780', 'val': 0},
                    {'key': u'201149469', 'val': 0},
                    {'key': u'201149544', 'val': 0},
                    {'key': u'201149541', 'val': 0},
                    {'key': u'201149462', 'val': 0},
                    {'key': u'201149652', 'val': 0},
                    {'key': u'201149396', 'val': 0},
                    {'key': u'201149077', 'val': 0},
                    {'key': u'201149253', 'val': 0},
                    {'key': u'201148544', 'val': 0},
                    {'key': u'201145759', 'val': 0},
                    {'key': u'201148972', 'val': 0},
                    {'key': u'201148639', 'val': 0},
                    {'key': u'201148539', 'val': 0},
                    {'key': u'201149321', 'val': 0},
                    {'key': u'201149241', 'val': 0},
                    {'key': u'201148530', 'val': 0},
                    {'key': u'201148886', 'val': 0},
                    {'key': u'201149976', 'val': 0},
                    {'key': u'201145234', 'val': 0},
                    {'key': u'201150125', 'val': 0},
                    {'key': u'201147140', 'val': 0},
                    {'key': u'201147282', 'val': 0},
                    {'key': u'201149733', 'val': 0},
                    {'key': u'201146741', 'val': 0},
                    {'key': u'201150040', 'val': 0},
                    {'key': u'201148440', 'val': 0},
                    {'key': u'201149336', 'val': 0},
                    {'key': u'201144944', 'val': 0},
                    {'key': u'201147471', 'val': 0},
                    {'key': u'201148956', 'val': 0},
                    {'key': u'201149534', 'val': 0},
                    {'key': u'201149741', 'val': 0},
                    {'key': u'201149940', 'val': 0},
                    {'key': u'201149622', 'val': 0},
                    {'key': u'201148329', 'val': '63100.00'},
                    {'key': u'201145114', 'val': 0},
                    {'key': u'201149229', 'val': 0},
                    {'key': u'201149582', 'val': 0},
                    {'key': u'201149828', 'val': 0},
                    {'key': u'201149589', 'val': 0},
                    {'key': u'201148353', 'val': 0},
                    {'key': u'201145359', 'val': 0},
                    {'key': u'201149474', 'val': 0},
                    {'key': u'201148589', 'val': 0},
                    {'key': u'201149751', 'val': 0},
                    {'key': u'201149359', 'val': 0}],
                    [{'bid': u'6:32:36 PM 1104138'},
                    {'key': u'201149215', 'val': '3838.20'},
                    {'key': u'201149597', 'val': '2008.05'},
                    {'key': u'201149168', 'val': '828.56'},
                    {'key': u'201148342', 'val': '2222.50'},
                    {'key': u'201149456', 'val': '1676.62'},
                    {'key': u'201147544', 'val': '2833.69'},
                    {'key': u'201148832', 'val': '5090.98'},
                    {'key': u'201148834', 'val': '2222.50'},
                    {'key': u'201149167', 'val': '1374.44'},
                    {'key': u'201149289', 'val': '3216.78'},
                    {'key': u'201149284', 'val': '2066.53'},
                    {'key': u'201150096', 'val': '1618.14'},
                    {'key': u'201149204', 'val': '3041.32'},
                    {'key': u'201149047', 'val': '1930.07'},
                    {'key': u'201147653', 'val': '3060.81'},
                    {'key': u'201149687', 'val': '3918.62'},
                    {'key': u'201149257', 'val': '1705.87'},
                    {'key': u'201149444', 'val': '6097.25'},
                    {'key': u'201150008', 'val': '2242.00'},
                    {'key': u'201149579', 'val': '9962.26'},
                    {'key': u'201148009', 'val': '2729.39'},
                    {'key': u'201149471', 'val': '1739.98'},
                    {'key': u'201149935', 'val': '2105.53'},
                    {'key': u'201149441', 'val': '1803.34'},
                    {'key': u'201149846', 'val': '3899.12'},
                    {'key': u'201149778', 'val': '974.78'},
                    {'key': u'201149565', 'val': '3216.78'},
                    {'key': u'201149560', 'val': '2339.47'},
                    {'key': u'201149562', 'val': '12184.76'},
                    {'key': u'201148993', 'val': '4912.89'},
                    {'key': u'201146570', 'val': '4464.50'},
                    {'key': u'201147482', 'val': '4064.84'},
                    {'key': u'201149372', 'val': '3996.60'},
                    {'key': u'201149374', 'val': '2851.96'},
                    {'key': u'201149875', 'val': '3933.24'},
                    {'key': u'201149988', 'val': '2115.27'},
                    {'key': u'201149905', 'val': '1958.33'},
                    {'key': u'201145735', 'val': '2485.69'},
                    {'key': u'201149703', 'val': '6005.62'},
                    {'key': u'201149669', 'val': '1965.16'},
                    {'key': u'201149577', 'val': '1237.97'},
                    {'key': u'201148154', 'val': '2631.91'},
                    {'key': u'201149578', 'val': '8407.48'},
                    {'key': u'201149477', 'val': '5700.42'},
                    {'key': u'201149269', 'val': '1330.10'},
                    {'key': u'201149664', 'val': '2745.69'},
                    {'key': u'201149063', 'val': '2173.76'},
                    {'key': u'201144387', 'val': '3980.79'},
                    {'key': u'201149991', 'val': '1559.65'},
                    {'key': u'201147776', 'val': '3189.48'},
                    {'key': u'201149154', 'val': '2612.41'},
                    {'key': u'201149912', 'val': '2261.49'},
                    {'key': u'201149712', 'val': '1317.90'},
                    {'key': u'201148780', 'val': '2875.60'},
                    {'key': u'201149469', 'val': '2271.24'},
                    {'key': u'201149544', 'val': '3119.30'},
                    {'key': u'201149541', 'val': '2436.95'},
                    {'key': u'201149462', 'val': '4730.61'},
                    {'key': u'201149652', 'val': '2422.67'},
                    {'key': u'201149396', 'val': '1742.91'},
                    {'key': u'201149077', 'val': '2145.81'},
                    {'key': u'201149253', 'val': '2573.42'},
                    {'key': u'201148544', 'val': '2495.44'},
                    {'key': u'201145759', 'val': '4064.84'},
                    {'key': u'201148972', 'val': '2534.43'},
                    {'key': u'201148639', 'val': '1842.34'},
                    {'key': u'201148539', 'val': '3420.25'},
                    {'key': u'201149321', 'val': '1832.59'},
                    {'key': u'201149241', 'val': '2865.85'},
                    {'key': u'201148530', 'val': '2198.13'},
                    {'key': u'201148886', 'val': '2349.22'},
                    {'key': u'201149976', 'val': '974.78'},
                    {'key': u'201145234', 'val': '6097.25'},
                    {'key': u'201150125', 'val': '3840.64'},
                    {'key': u'201147140', 'val': '1435.36'},
                    {'key': u'201147282', 'val': '4664.39'},
                    {'key': u'201149733', 'val': '2826.86'},
                    {'key': u'201146741', 'val': '2436.95'},
                    {'key': u'201150040', 'val': '3567.70'},
                    {'key': u'201148440', 'val': '3655.43'},
                    {'key': u'201149336', 'val': '935.79'},
                    {'key': u'201144944', 'val': '3509.21'},
                    {'key': u'201147471', 'val': '2934.09'},
                    {'key': u'201148956', 'val': '389.91'},
                    {'key': u'201149534', 'val': '1803.34'},
                    {'key': u'201149741', 'val': '4064.84'},
                    {'key': u'201149940', 'val': '3445.57'},
                    {'key': u'201149622', 'val': '2636.78'},
                    {'key': u'201148329', 'val': '922.63'},
                    {'key': u'201145114', 'val': '2534.43'},
                    {'key': u'201149229', 'val': '2517.86'},
                    {'key': u'201149582', 'val': '2607.54'},
                    {'key': u'201149828', 'val': '1198.98'},
                    {'key': u'201149589', 'val': '1949.56'},
                    {'key': u'201148353', 'val': '1481.67'},
                    {'key': u'201145359', 'val': '2729.39'},
                    {'key': u'201149474', 'val': '2963.33'},
                    {'key': u'201148589', 'val': '3928.37'},
                    {'key': u'201149751', 'val': '7817.25'},
                    {'key': u'201149359', 'val': '2357.02'}],
                    [{'bid': u'8:42:12 PM 1104141'},
                    {'key': u'201149215', 'val': '3646.29'},
                    {'key': u'201149597', 'val': '1907.65'},
                    {'key': u'201149168', 'val': '787.14'},
                    {'key': u'201148342', 'val': '2111.37'},
                    {'key': u'201149456', 'val': '1592.79'},
                    {'key': u'201147544', 'val': '2692.00'},
                    {'key': u'201148832', 'val': '4836.43'},
                    {'key': u'201148834', 'val': '2111.37'},
                    {'key': u'201149167', 'val': '1305.72'},
                    {'key': u'201149289', 'val': '3055.94'},
                    {'key': u'201149284', 'val': '1963.21'},
                    {'key': u'201150096', 'val': '1537.23'},
                    {'key': u'201149204', 'val': '2889.25'},
                    {'key': u'201149047', 'val': '1833.56'},
                    {'key': u'201147653', 'val': '2907.77'},
                    {'key': u'201149687', 'val': '3722.69'},
                    {'key': u'201149257', 'val': '1620.57'},
                    {'key': u'201149444', 'val': '5792.39'},
                    {'key': u'201150008', 'val': '2129.90'},
                    {'key': u'201149579', 'val': '9464.14'},
                    {'key': u'201148009', 'val': '2592.92'},
                    {'key': u'201149471', 'val': '1652.98'},
                    {'key': u'201149935', 'val': '2000.25'},
                    {'key': u'201149441', 'val': '1713.18'},
                    {'key': u'201149846', 'val': '3704.17'},
                    {'key': u'201149778', 'val': '926.04'},
                    {'key': u'201149565', 'val': '3055.94'},
                    {'key': u'201149560', 'val': '2222.50'},
                    {'key': u'201149562', 'val': '11575.52'},
                    {'key': u'201148993', 'val': '4667.25'},
                    {'key': u'201146570', 'val': '4241.27'},
                    {'key': u'201147482', 'val': '3861.59'},
                    {'key': u'201149372', 'val': '3796.77'},
                    {'key': u'201149374', 'val': '2709.37'},
                    {'key': u'201149875', 'val': '3736.58'},
                    {'key': u'201149988', 'val': '2009.51'},
                    {'key': u'201149905', 'val': '1860.42'},
                    {'key': u'201145735', 'val': '2361.41'},
                    {'key': u'201149703', 'val': '5705.34'},
                    {'key': u'201149669', 'val': '1866.90'},
                    {'key': u'201149577', 'val': '1176.07'},
                    {'key': u'201148154', 'val': '2500.31'},
                    {'key': u'201149578', 'val': '7987.11'},
                    {'key': u'201149477', 'val': '5415.40'},
                    {'key': u'201149269', 'val': '1263.59'},
                    {'key': u'201149664', 'val': '2608.41'},
                    {'key': u'201149063', 'val': '2065.07'},
                    {'key': u'201144387', 'val': '3781.75'},
                    {'key': u'201149991', 'val': '1481.67'},
                    {'key': u'201147776', 'val': '3030.01'},
                    {'key': u'201149154', 'val': '2481.79'},
                    {'key': u'201149912', 'val': '2148.42'},
                    {'key': u'201149712', 'val': '1252.01'},
                    {'key': u'201148780', 'val': '2731.82'},
                    {'key': u'201149469', 'val': '2157.68'},
                    {'key': u'201149544', 'val': '2963.33'},
                    {'key': u'201149541', 'val': '2315.10'},
                    {'key': u'201149462', 'val': '4494.08'},
                    {'key': u'201149652', 'val': '2301.54'},
                    {'key': u'201149396', 'val': '1655.76'},
                    {'key': u'201149077', 'val': '2038.52'},
                    {'key': u'201149253', 'val': '2444.75'},
                    {'key': u'201148544', 'val': '2370.67'},
                    {'key': u'201145759', 'val': '3861.59'},
                    {'key': u'201148972', 'val': '2407.71'},
                    {'key': u'201148639', 'val': '1750.22'},
                    {'key': u'201148539', 'val': '3249.24'},
                    {'key': u'201149321', 'val': '1740.96'},
                    {'key': u'201149241', 'val': '2722.56'},
                    {'key': u'201148530', 'val': '2088.22'},
                    {'key': u'201148886', 'val': '2231.76'},
                    {'key': u'201149976', 'val': '926.04'},
                    {'key': u'201145234', 'val': '5792.39'},
                    {'key': u'201150125', 'val': '3648.60'},
                    {'key': u'201147140', 'val': '1363.60'},
                    {'key': u'201147282', 'val': '4431.17'},
                    {'key': u'201149733', 'val': '2685.52'},
                    {'key': u'201146741', 'val': '2315.10'},
                    {'key': u'201150040', 'val': '3389.31'},
                    {'key': u'201148440', 'val': '3472.66'},
                    {'key': u'201149336', 'val': '889.00'},
                    {'key': u'201144944', 'val': '3333.75'},
                    {'key': u'201147471', 'val': '2787.39'},
                    {'key': u'201148956', 'val': '370.42'},
                    {'key': u'201149534', 'val': '1713.18'},
                    {'key': u'201149741', 'val': '3861.59'},
                    {'key': u'201149940', 'val': '3273.29'},
                    {'key': u'201149622', 'val': '2504.94'},
                    {'key': u'201148329', 'val': '876.50'},
                    {'key': u'201145114', 'val': '2407.71'},
                    {'key': u'201149229', 'val': '2391.97'},
                    {'key': u'201149582', 'val': '2477.16'},
                    {'key': u'201149828', 'val': '1139.03'},
                    {'key': u'201149589', 'val': '1852.08'},
                    {'key': u'201148353', 'val': '1407.58'},
                    {'key': u'201145359', 'val': '2592.92'},
                    {'key': u'201149474', 'val': '2815.17'},
                    {'key': u'201148589', 'val': '3731.95'},
                    {'key': u'201149751', 'val': '7426.39'},
                    {'key': u'201149359', 'val': '2239.17'}],
                    [{'bid': u'11:06:12 PM 1104161'},
                    {'key': u'201149215', 'val': 0},
                    {'key': u'201149597', 'val': 0},
                    {'key': u'201149168', 'val': 0},
                    {'key': u'201148342', 'val': 0},
                    {'key': u'201149456', 'val': 0},
                    {'key': u'201147544', 'val': 0},
                    {'key': u'201148832', 'val': 0},
                    {'key': u'201148834', 'val': 0},
                    {'key': u'201149167', 'val': 0},
                    {'key': u'201149289', 'val': 0},
                    {'key': u'201149284', 'val': 0},
                    {'key': u'201150096', 'val': 0},
                    {'key': u'201149204', 'val': 0},
                    {'key': u'201149047', 'val': 0},
                    {'key': u'201147653', 'val': 0},
                    {'key': u'201149687', 'val': 0},
                    {'key': u'201149257', 'val': 0},
                    {'key': u'201149444', 'val': 0},
                    {'key': u'201150008', 'val': 0},
                    {'key': u'201149579', 'val': 0},
                    {'key': u'201148009', 'val': 0},
                    {'key': u'201149471', 'val': 0},
                    {'key': u'201149935', 'val': 0},
                    {'key': u'201149441', 'val': 0},
                    {'key': u'201149846', 'val': 0},
                    {'key': u'201149778', 'val': 0},
                    {'key': u'201149565', 'val': 0},
                    {'key': u'201149560', 'val': 0},
                    {'key': u'201149562', 'val': 0},
                    {'key': u'201148993', 'val': 0},
                    {'key': u'201146570', 'val': 0},
                    {'key': u'201147482', 'val': 0},
                    {'key': u'201149372', 'val': 0},
                    {'key': u'201149374', 'val': 0},
                    {'key': u'201149875', 'val': 0},
                    {'key': u'201149988', 'val': 0},
                    {'key': u'201149905', 'val': 0},
                    {'key': u'201145735', 'val': 0},
                    {'key': u'201149703', 'val': 0},
                    {'key': u'201149669', 'val': '100800.00'},
                    {'key': u'201149577', 'val': 0},
                    {'key': u'201148154', 'val': 0},
                    {'key': u'201149578', 'val': 0},
                    {'key': u'201149477', 'val': 0},
                    {'key': u'201149269', 'val': 0},
                    {'key': u'201149664', 'val': 0},
                    {'key': u'201149063', 'val': 0},
                    {'key': u'201144387', 'val': 0},
                    {'key': u'201149991', 'val': 0},
                    {'key': u'201147776', 'val': 0},
                    {'key': u'201149154', 'val': 0},
                    {'key': u'201149912', 'val': 0},
                    {'key': u'201149712', 'val': 0},
                    {'key': u'201148780', 'val': 0},
                    {'key': u'201149469', 'val': 0},
                    {'key': u'201149544', 'val': 0},
                    {'key': u'201149541', 'val': 0},
                    {'key': u'201149462', 'val': 0},
                    {'key': u'201149652', 'val': 0},
                    {'key': u'201149396', 'val': 0},
                    {'key': u'201149077', 'val': 0},
                    {'key': u'201149253', 'val': 0},
                    {'key': u'201148544', 'val': 0},
                    {'key': u'201145759', 'val': 0},
                    {'key': u'201148972', 'val': 0},
                    {'key': u'201148639', 'val': 0},
                    {'key': u'201148539', 'val': 0},
                    {'key': u'201149321', 'val': 0},
                    {'key': u'201149241', 'val': 0},
                    {'key': u'201148530', 'val': 0},
                    {'key': u'201148886', 'val': 0},
                    {'key': u'201149976', 'val': 0},
                    {'key': u'201145234', 'val': 0},
                    {'key': u'201150125', 'val': 0},
                    {'key': u'201147140', 'val': 0},
                    {'key': u'201147282', 'val': 0},
                    {'key': u'201149733', 'val': 0},
                    {'key': u'201146741', 'val': 0},
                    {'key': u'201150040', 'val': 0},
                    {'key': u'201148440', 'val': 0},
                    {'key': u'201149336', 'val': 0},
                    {'key': u'201144944', 'val': 0},
                    {'key': u'201147471', 'val': 0},
                    {'key': u'201148956', 'val': 0},
                    {'key': u'201149534', 'val': 0},
                    {'key': u'201149741', 'val': 0},
                    {'key': u'201149940', 'val': 0},
                    {'key': u'201149622', 'val': 0},
                    {'key': u'201148329', 'val': 0},
                    {'key': u'201145114', 'val': 0},
                    {'key': u'201149229', 'val': 0},
                    {'key': u'201149582', 'val': 0},
                    {'key': u'201149828', 'val': 0},
                    {'key': u'201149589', 'val': 0},
                    {'key': u'201148353', 'val': 0},
                    {'key': u'201145359', 'val': 0},
                    {'key': u'201149474', 'val': 0},
                    {'key': u'201148589', 'val': 0},
                    {'key': u'201149751', 'val': 0},
                    {'key': u'201149359', 'val': 0}],
                    [{'bid': u'2:23:00 AM 1104133'},
                    {'key': u'201149215', 'val': 0},
                    {'key': u'201149597', 'val': 0},
                    {'key': u'201149168', 'val': 0},
                    {'key': u'201148342', 'val': 0},
                    {'key': u'201149456', 'val': 0},
                    {'key': u'201147544', 'val': 0},
                    {'key': u'201148832', 'val': 0},
                    {'key': u'201148834', 'val': 0},
                    {'key': u'201149167', 'val': 0},
                    {'key': u'201149289', 'val': 0},
                    {'key': u'201149284', 'val': 0},
                    {'key': u'201150096', 'val': 0},
                    {'key': u'201149204', 'val': 0},
                    {'key': u'201149047', 'val': 0},
                    {'key': u'201147653', 'val': 0},
                    {'key': u'201149687', 'val': 0},
                    {'key': u'201149257', 'val': 0},
                    {'key': u'201149444', 'val': 0},
                    {'key': u'201150008', 'val': 0},
                    {'key': u'201149579', 'val': 0},
                    {'key': u'201148009', 'val': 0},
                    {'key': u'201149471', 'val': 0},
                    {'key': u'201149935', 'val': 0},
                    {'key': u'201149441', 'val': 0},
                    {'key': u'201149846', 'val': 0},
                    {'key': u'201149778', 'val': 0},
                    {'key': u'201149565', 'val': 0},
                    {'key': u'201149560', 'val': 0},
                    {'key': u'201149562', 'val': 0},
                    {'key': u'201148993', 'val': 0},
                    {'key': u'201146570', 'val': 0},
                    {'key': u'201147482', 'val': 0},
                    {'key': u'201149372', 'val': 0},
                    {'key': u'201149374', 'val': 0},
                    {'key': u'201149875', 'val': 0},
                    {'key': u'201149988', 'val': 0},
                    {'key': u'201149905', 'val': 0},
                    {'key': u'201145735', 'val': 0},
                    {'key': u'201149703', 'val': 0},
                    {'key': u'201149669', 'val': '100800.00'},
                    {'key': u'201149577', 'val': 0},
                    {'key': u'201148154', 'val': 0},
                    {'key': u'201149578', 'val': 0},
                    {'key': u'201149477', 'val': 0},
                    {'key': u'201149269', 'val': 0},
                    {'key': u'201149664', 'val': 0},
                    {'key': u'201149063', 'val': 0},
                    {'key': u'201144387', 'val': 0},
                    {'key': u'201149991', 'val': 0},
                    {'key': u'201147776', 'val': 0},
                    {'key': u'201149154', 'val': 0},
                    {'key': u'201149912', 'val': 0},
                    {'key': u'201149712', 'val': 0},
                    {'key': u'201148780', 'val': 0},
                    {'key': u'201149469', 'val': 0},
                    {'key': u'201149544', 'val': 0},
                    {'key': u'201149541', 'val': 0},
                    {'key': u'201149462', 'val': 0},
                    {'key': u'201149652', 'val': 0},
                    {'key': u'201149396', 'val': 0},
                    {'key': u'201149077', 'val': 0},
                    {'key': u'201149253', 'val': 0},
                    {'key': u'201148544', 'val': 0},
                    {'key': u'201145759', 'val': 0},
                    {'key': u'201148972', 'val': 0},
                    {'key': u'201148639', 'val': 0},
                    {'key': u'201148539', 'val': 0},
                    {'key': u'201149321', 'val': 0},
                    {'key': u'201149241', 'val': 0},
                    {'key': u'201148530', 'val': 0},
                    {'key': u'201148886', 'val': 0},
                    {'key': u'201149976', 'val': 0},
                    {'key': u'201145234', 'val': 0},
                    {'key': u'201150125', 'val': 0},
                    {'key': u'201147140', 'val': 0},
                    {'key': u'201147282', 'val': 0},
                    {'key': u'201149733', 'val': 0},
                    {'key': u'201146741', 'val': 0},
                    {'key': u'201150040', 'val': 0},
                    {'key': u'201148440', 'val': 0},
                    {'key': u'201149336', 'val': 0},
                    {'key': u'201144944', 'val': 0},
                    {'key': u'201147471', 'val': 0},
                    {'key': u'201148956', 'val': 0},
                    {'key': u'201149534', 'val': 0},
                    {'key': u'201149741', 'val': 0},
                    {'key': u'201149940', 'val': 0},
                    {'key': u'201149622', 'val': 0},
                    {'key': u'201148329', 'val': 0},
                    {'key': u'201145114', 'val': 0},
                    {'key': u'201149229', 'val': 0},
                    {'key': u'201149582', 'val': 0},
                    {'key': u'201149828', 'val': 0},
                    {'key': u'201149589', 'val': 0},
                    {'key': u'201148353', 'val': 0},
                    {'key': u'201145359', 'val': 0},
                    {'key': u'201149474', 'val': 0},
                    {'key': u'201148589', 'val': 0},
                    {'key': u'201149751', 'val': 0},
                    {'key': u'201149359', 'val': 0}],
                    [{'bid': u'9:39:48 PM 1104159'},
                    {'key': u'201149215', 'val': 0},
                    {'key': u'201149597', 'val': 0},
                    {'key': u'201149168', 'val': 0},
                    {'key': u'201148342', 'val': 0},
                    {'key': u'201149456', 'val': 0},
                    {'key': u'201147544', 'val': 0},
                    {'key': u'201148832', 'val': 0},
                    {'key': u'201148834', 'val': 0},
                    {'key': u'201149167', 'val': 0},
                    {'key': u'201149289', 'val': 0},
                    {'key': u'201149284', 'val': 0},
                    {'key': u'201150096', 'val': 0},
                    {'key': u'201149204', 'val': 0},
                    {'key': u'201149047', 'val': 0},
                    {'key': u'201147653', 'val': 0},
                    {'key': u'201149687', 'val': 0},
                    {'key': u'201149257', 'val': 0},
                    {'key': u'201149444', 'val': 0},
                    {'key': u'201150008', 'val': 0},
                    {'key': u'201149579', 'val': 0},
                    {'key': u'201148009', 'val': 0},
                    {'key': u'201149471', 'val': 0},
                    {'key': u'201149935', 'val': 0},
                    {'key': u'201149441', 'val': 0},
                    {'key': u'201149846', 'val': 0},
                    {'key': u'201149778', 'val': 0},
                    {'key': u'201149565', 'val': 0},
                    {'key': u'201149560', 'val': 0},
                    {'key': u'201149562', 'val': 0},
                    {'key': u'201148993', 'val': 0},
                    {'key': u'201146570', 'val': 0},
                    {'key': u'201147482', 'val': 0},
                    {'key': u'201149372', 'val': 0},
                    {'key': u'201149374', 'val': 0},
                    {'key': u'201149875', 'val': 0},
                    {'key': u'201149988', 'val': 0},
                    {'key': u'201149905', 'val': 0},
                    {'key': u'201145735', 'val': 0},
                    {'key': u'201149703', 'val': 0},
                    {'key': u'201149669', 'val': 0},
                    {'key': u'201149577', 'val': 0},
                    {'key': u'201148154', 'val': 0},
                    {'key': u'201149578', 'val': 0},
                    {'key': u'201149477', 'val': 0},
                    {'key': u'201149269', 'val': 0},
                    {'key': u'201149664', 'val': 0},
                    {'key': u'201149063', 'val': 0},
                    {'key': u'201144387', 'val': 0},
                    {'key': u'201149991', 'val': 0},
                    {'key': u'201147776', 'val': 0},
                    {'key': u'201149154', 'val': 0},
                    {'key': u'201149912', 'val': 0},
                    {'key': u'201149712', 'val': 0},
                    {'key': u'201148780', 'val': 0},
                    {'key': u'201149469', 'val': 0},
                    {'key': u'201149544', 'val': 0},
                    {'key': u'201149541', 'val': 0},
                    {'key': u'201149462', 'val': 0},
                    {'key': u'201149652', 'val': 0},
                    {'key': u'201149396', 'val': 0},
                    {'key': u'201149077', 'val': 0},
                    {'key': u'201149253', 'val': 0},
                    {'key': u'201148544', 'val': 0},
                    {'key': u'201145759', 'val': 0},
                    {'key': u'201148972', 'val': 0},
                    {'key': u'201148639', 'val': 0},
                    {'key': u'201148539', 'val': 0},
                    {'key': u'201149321', 'val': 0},
                    {'key': u'201149241', 'val': 0},
                    {'key': u'201148530', 'val': 0},
                    {'key': u'201148886', 'val': 0},
                    {'key': u'201149976', 'val': 0},
                    {'key': u'201145234', 'val': 0},
                    {'key': u'201150125', 'val': 0},
                    {'key': u'201147140', 'val': 0},
                    {'key': u'201147282', 'val': 0},
                    {'key': u'201149733', 'val': 0},
                    {'key': u'201146741', 'val': 0},
                    {'key': u'201150040', 'val': 0},
                    {'key': u'201148440', 'val': 0},
                    {'key': u'201149336', 'val': 0},
                    {'key': u'201144944', 'val': 0},
                    {'key': u'201147471', 'val': 0},
                    {'key': u'201148956', 'val': 0},
                    {'key': u'201149534', 'val': 0},
                    {'key': u'201149741', 'val': 0},
                    {'key': u'201149940', 'val': 0},
                    {'key': u'201149622', 'val': 0},
                    {'key': u'201148329', 'val': '63100.00'},
                    {'key': u'201145114', 'val': 0},
                    {'key': u'201149229', 'val': 0},
                    {'key': u'201149582', 'val': 0},
                    {'key': u'201149828', 'val': 0},
                    {'key': u'201149589', 'val': 0},
                    {'key': u'201148353', 'val': 0},
                    {'key': u'201145359', 'val': 0},
                    {'key': u'201149474', 'val': 0},
                    {'key': u'201148589', 'val': 0},
                    {'key': u'201149751', 'val': 0},
                    {'key': u'201149359', 'val': 0}],
                    [{'bid': u'11:35:00 PM 1104145'},
                    {'key': u'201149215', 'val': 0},
                    {'key': u'201149597', 'val': 0},
                    {'key': u'201149168', 'val': 0},
                    {'key': u'201148342', 'val': 0},
                    {'key': u'201149456', 'val': 0},
                    {'key': u'201147544', 'val': 0},
                    {'key': u'201148832', 'val': 0},
                    {'key': u'201148834', 'val': 0},
                    {'key': u'201149167', 'val': 0},
                    {'key': u'201149289', 'val': 0},
                    {'key': u'201149284', 'val': 0},
                    {'key': u'201150096', 'val': 0},
                    {'key': u'201149204', 'val': 0},
                    {'key': u'201149047', 'val': 0},
                    {'key': u'201147653', 'val': 0},
                    {'key': u'201149687', 'val': 0},
                    {'key': u'201149257', 'val': 0},
                    {'key': u'201149444', 'val': 0},
                    {'key': u'201150008', 'val': 0},
                    {'key': u'201149579', 'val': 0},
                    {'key': u'201148009', 'val': 0},
                    {'key': u'201149471', 'val': 0},
                    {'key': u'201149935', 'val': 0},
                    {'key': u'201149441', 'val': 0},
                    {'key': u'201149846', 'val': 0},
                    {'key': u'201149778', 'val': 0},
                    {'key': u'201149565', 'val': 0},
                    {'key': u'201149560', 'val': 0},
                    {'key': u'201149562', 'val': 0},
                    {'key': u'201148993', 'val': 0},
                    {'key': u'201146570', 'val': 0},
                    {'key': u'201147482', 'val': 0},
                    {'key': u'201149372', 'val': 0},
                    {'key': u'201149374', 'val': 0},
                    {'key': u'201149875', 'val': 0},
                    {'key': u'201149988', 'val': 0},
                    {'key': u'201149905', 'val': 0},
                    {'key': u'201145735', 'val': 0},
                    {'key': u'201149703', 'val': 0},
                    {'key': u'201149669', 'val': 0},
                    {'key': u'201149577', 'val': 0},
                    {'key': u'201148154', 'val': 0},
                    {'key': u'201149578', 'val': 0},
                    {'key': u'201149477', 'val': 0},
                    {'key': u'201149269', 'val': 0},
                    {'key': u'201149664', 'val': 0},
                    {'key': u'201149063', 'val': 0},
                    {'key': u'201144387', 'val': 0},
                    {'key': u'201149991', 'val': 0},
                    {'key': u'201147776', 'val': 0},
                    {'key': u'201149154', 'val': 0},
                    {'key': u'201149912', 'val': 0},
                    {'key': u'201149712', 'val': 0},
                    {'key': u'201148780', 'val': 0},
                    {'key': u'201149469', 'val': 0},
                    {'key': u'201149544', 'val': 0},
                    {'key': u'201149541', 'val': 0},
                    {'key': u'201149462', 'val': 0},
                    {'key': u'201149652', 'val': 0},
                    {'key': u'201149396', 'val': 0},
                    {'key': u'201149077', 'val': 0},
                    {'key': u'201149253', 'val': 0},
                    {'key': u'201148544', 'val': 0},
                    {'key': u'201145759', 'val': 0},
                    {'key': u'201148972', 'val': 0},
                    {'key': u'201148639', 'val': 0},
                    {'key': u'201148539', 'val': 0},
                    {'key': u'201149321', 'val': 0},
                    {'key': u'201149241', 'val': 0},
                    {'key': u'201148530', 'val': 0},
                    {'key': u'201148886', 'val': 0},
                    {'key': u'201149976', 'val': 0},
                    {'key': u'201145234', 'val': 0},
                    {'key': u'201150125', 'val': 0},
                    {'key': u'201147140', 'val': 0},
                    {'key': u'201147282', 'val': 0},
                    {'key': u'201149733', 'val': 0},
                    {'key': u'201146741', 'val': 0},
                    {'key': u'201150040', 'val': 0},
                    {'key': u'201148440', 'val': 0},
                    {'key': u'201149336', 'val': 0},
                    {'key': u'201144944', 'val': 0},
                    {'key': u'201147471', 'val': 0},
                    {'key': u'201148956', 'val': 0},
                    {'key': u'201149534', 'val': 0},
                    {'key': u'201149741', 'val': 0},
                    {'key': u'201149940', 'val': 0},
                    {'key': u'201149622', 'val': 0},
                    {'key': u'201148329', 'val': '31550.00'},
                    {'key': u'201145114', 'val': 0},
                    {'key': u'201149229', 'val': 0},
                    {'key': u'201149582', 'val': 0},
                    {'key': u'201149828', 'val': 0},
                    {'key': u'201149589', 'val': 0},
                    {'key': u'201148353', 'val': 0},
                    {'key': u'201145359', 'val': 0},
                    {'key': u'201149474', 'val': 0},
                    {'key': u'201148589', 'val': 0},
                    {'key': u'201149751', 'val': 0},
                    {'key': u'201149359', 'val': 0}],
                    [{'bid': u'4:37:24 AM 1104131'},
                    {'key': u'201149215', 'val': '160946.39'},
                    {'key': u'201149597', 'val': '84203.07'},
                    {'key': u'201149168', 'val': '34743.98'},
                    {'key': u'201148342', 'val': '93195.63'},
                    {'key': u'201149456', 'val': '70305.47'},
                    {'key': u'201147544', 'val': '118824.42'},
                    {'key': u'201148832', 'val': '213478.89'},
                    {'key': u'201148834', 'val': '93195.63'},
                    {'key': u'201149167', 'val': '57634.14'},
                    {'key': u'201149289', 'val': '134888.41'},
                    {'key': u'201149284', 'val': '86655.58'},
                    {'key': u'201150096', 'val': '67852.96'},
                    {'key': u'201149204', 'val': '127530.86'},
                    {'key': u'201149047', 'val': '80933.04'},
                    {'key': u'201147653', 'val': '128348.36'},
                    {'key': u'201149687', 'val': '164318.60'},
                    {'key': u'201149257', 'val': '71531.73'},
                    {'key': u'201149444', 'val': '255674.84'},
                    {'key': u'201150008', 'val': '94013.13'},
                    {'key': u'201149579', 'val': '417745.31'},
                    {'key': u'201148009', 'val': '114450.77'},
                    {'key': u'201149471', 'val': '72962.37'},
                    {'key': u'201149935', 'val': '88290.59'},
                    {'key': u'201149441', 'val': '75619.26'},
                    {'key': u'201149846', 'val': '163501.10'},
                    {'key': u'201149778', 'val': '40875.27'},
                    {'key': u'201149565', 'val': '134888.41'},
                    {'key': u'201149560', 'val': '98100.66'},
                    {'key': u'201149562', 'val': '510940.93'},
                    {'key': u'201148993', 'val': '206011.38'},
                    {'key': u'201146570', 'val': '187208.76'},
                    {'key': u'201147482', 'val': '170449.90'},
                    {'key': u'201149372', 'val': '167588.63'},
                    {'key': u'201149374', 'val': '119590.83'},
                    {'key': u'201149875', 'val': '164931.73'},
                    {'key': u'201149988', 'val': '88699.35'},
                    {'key': u'201149905', 'val': '82118.43'},
                    {'key': u'201145735', 'val': '104231.95'},
                    {'key': u'201149703', 'val': '251832.57'},
                    {'key': u'201149669', 'val': '82404.55'},
                    {'key': u'201149577', 'val': '51911.60'},
                    {'key': u'201148154', 'val': '110363.24'},
                    {'key': u'201149578', 'val': '352549.24'},
                    {'key': u'201149477', 'val': '239034.52'},
                    {'key': u'201149269', 'val': '55774.72'},
                    {'key': u'201149664', 'val': '115134.61'},
                    {'key': u'201149063', 'val': '91151.86'},
                    {'key': u'201144387', 'val': '166925.63'},
                    {'key': u'201149991', 'val': '65400.44'},
                    {'key': u'201147776', 'val': '133743.90'},
                    {'key': u'201149154', 'val': '109545.74'},
                    {'key': u'201149912', 'val': '94830.64'},
                    {'key': u'201149712', 'val': '55263.37'},
                    {'key': u'201148780', 'val': '120582.06'},
                    {'key': u'201149469', 'val': '95239.39'},
                    {'key': u'201149544', 'val': '130800.88'},
                    {'key': u'201149541', 'val': '102188.19'},
                    {'key': u'201149462', 'val': '198367.71'},
                    {'key': u'201149652', 'val': '101589.36'},
                    {'key': u'201149396', 'val': '73084.99'},
                    {'key': u'201149077', 'val': '89979.97'},
                    {'key': u'201149253', 'val': '107910.73'},
                    {'key': u'201148544', 'val': '104640.70'},
                    {'key': u'201145759', 'val': '170449.90'},
                    {'key': u'201148972', 'val': '106275.71'},
                    {'key': u'201148639', 'val': '77254.27'},
                    {'key': u'201148539', 'val': '143420.71'},
                    {'key': u'201149321', 'val': '76845.52'},
                    {'key': u'201149241', 'val': '120173.31'},
                    {'key': u'201148530', 'val': '92173.74'},
                    {'key': u'201148886', 'val': '98509.41'},
                    {'key': u'201149976', 'val': '40875.27'},
                    {'key': u'201145234', 'val': '255674.84'},
                    {'key': u'201150125', 'val': '161048.58'},
                    {'key': u'201147140', 'val': '60188.84'},
                    {'key': u'201147282', 'val': '195591.05'},
                    {'key': u'201149733', 'val': '118538.30'},
                    {'key': u'201146741', 'val': '102188.19'},
                    {'key': u'201150040', 'val': '149603.51'},
                    {'key': u'201148440', 'val': '153282.28'},
                    {'key': u'201149336', 'val': '39240.26'},
                    {'key': u'201144944', 'val': '147150.99'},
                    {'key': u'201147471', 'val': '123034.58'},
                    {'key': u'201148956', 'val': '16350.11'},
                    {'key': u'201149534', 'val': '75619.26'},
                    {'key': u'201149741', 'val': '170449.90'},
                    {'key': u'201149940', 'val': '144482.24'},
                    {'key': u'201149622', 'val': '110567.62'},
                    {'key': u'201148329', 'val': '38688.45'},
                    {'key': u'201145114', 'val': '106275.71'},
                    {'key': u'201149229', 'val': '105580.83'},
                    {'key': u'201149582', 'val': '109341.36'},
                    {'key': u'201149828', 'val': '50276.59'},
                    {'key': u'201149589', 'val': '81750.55'},
                    {'key': u'201148353', 'val': '62130.42'},
                    {'key': u'201145359', 'val': '114450.77'},
                    {'key': u'201149474', 'val': '124260.84'},
                    {'key': u'201148589', 'val': '164727.36'},
                    {'key': u'201149751', 'val': '327799.27'},
                    {'key': u'201149359', 'val': '98836.41'}],
                    [{'bid': u'8:13:24 AM 1104157'},
                    {'key': u'201149215', 'val': '169289.77'},
                    {'key': u'201149597', 'val': '88568.11'},
                    {'key': u'201149168', 'val': '36545.09'},
                    {'key': u'201148342', 'val': '98026.84'},
                    {'key': u'201149456', 'val': '73950.07'},
                    {'key': u'201147544', 'val': '124984.22'},
                    {'key': u'201148832', 'val': '224545.52'},
                    {'key': u'201148834', 'val': '98026.84'},
                    {'key': u'201149167', 'val': '60621.86'},
                    {'key': u'201149289', 'val': '141880.95'},
                    {'key': u'201149284', 'val': '91147.76'},
                    {'key': u'201150096', 'val': '71370.42'},
                    {'key': u'201149204', 'val': '134141.99'},
                    {'key': u'201149047', 'val': '85128.57'},
                    {'key': u'201147653', 'val': '135001.87'},
                    {'key': u'201149687', 'val': '172836.79'},
                    {'key': u'201149257', 'val': '75239.90'},
                    {'key': u'201149444', 'val': '268928.89'},
                    {'key': u'201150008', 'val': '98886.72'},
                    {'key': u'201149579', 'val': '439401.00'},
                    {'key': u'201148009', 'val': '120383.84'},
                    {'key': u'201149471', 'val': '76744.70'},
                    {'key': u'201149935', 'val': '92867.53'},
                    {'key': u'201149441', 'val': '79539.32'},
                    {'key': u'201149846', 'val': '171976.91'},
                    {'key': u'201149778', 'val': '42994.23'},
                    {'key': u'201149565', 'val': '141880.95'},
                    {'key': u'201149560', 'val': '103186.14'},
                    {'key': u'201149562', 'val': '537427.84'},
                    {'key': u'201148993', 'val': '216690.90'},
                    {'key': u'201146570', 'val': '196913.56'},
                    {'key': u'201147482', 'val': '179285.93'},
                    {'key': u'201149372', 'val': '176276.33'},
                    {'key': u'201149374', 'val': '125790.36'},
                    {'key': u'201149875', 'val': '173481.71'},
                    {'key': u'201149988', 'val': '93297.47'},
                    {'key': u'201149905', 'val': '86375.40'},
                    {'key': u'201145735', 'val': '109635.28'},
                    {'key': u'201149703', 'val': '264887.43'},
                    {'key': u'201149669', 'val': '86676.36'},
                    {'key': u'201149577', 'val': '54602.67'},
                    {'key': u'201148154', 'val': '116084.41'},
                    {'key': u'201149578', 'val': '370825.21'},
                    {'key': u'201149477', 'val': '251425.94'},
                    {'key': u'201149269', 'val': '58666.05'},
                    {'key': u'201149664', 'val': '121103.13'},
                    {'key': u'201149063', 'val': '95877.13'},
                    {'key': u'201144387', 'val': '175578.96'},
                    {'key': u'201149991', 'val': '68790.76'},
                    {'key': u'201147776', 'val': '140677.11'},
                    {'key': u'201149154', 'val': '115224.53'},
                    {'key': u'201149912', 'val': '99746.61'},
                    {'key': u'201149712', 'val': '58128.20'},
                    {'key': u'201148780', 'val': '126832.97'},
                    {'key': u'201149469', 'val': '100176.55'},
                    {'key': u'201149544', 'val': '137581.53'},
                    {'key': u'201149541', 'val': '107485.57'},
                    {'key': u'201149462', 'val': '208650.98'},
                    {'key': u'201149652', 'val': '106855.70'},
                    {'key': u'201149396', 'val': '76873.68'},
                    {'key': u'201149077', 'val': '94644.48'},
                    {'key': u'201149253', 'val': '113504.76'},
                    {'key': u'201148544', 'val': '110065.22'},
                    {'key': u'201145759', 'val': '179285.93'},
                    {'key': u'201148972', 'val': '111784.99'},
                    {'key': u'201148639', 'val': '81259.09'},
                    {'key': u'201148539', 'val': '150855.56'},
                    {'key': u'201149321', 'val': '80829.15'},
                    {'key': u'201149241', 'val': '126403.03'},
                    {'key': u'201148530', 'val': '96951.98'},
                    {'key': u'201148886', 'val': '103616.09'},
                    {'key': u'201149976', 'val': '42994.23'},
                    {'key': u'201145234', 'val': '268928.89'},
                    {'key': u'201150125', 'val': '169397.25'},
                    {'key': u'201147140', 'val': '63309.00'},
                    {'key': u'201147282', 'val': '205730.39'},
                    {'key': u'201149733', 'val': '124683.26'},
                    {'key': u'201146741', 'val': '107485.57'},
                    {'key': u'201150040', 'val': '157358.87'},
                    {'key': u'201148440', 'val': '161228.35'},
                    {'key': u'201149336', 'val': '41274.46'},
                    {'key': u'201144944', 'val': '154779.22'},
                    {'key': u'201147471', 'val': '129412.62'},
                    {'key': u'201148956', 'val': '17197.69'},
                    {'key': u'201149534', 'val': '79539.32'},
                    {'key': u'201149741', 'val': '179285.93'},
                    {'key': u'201149940', 'val': '151972.12'},
                    {'key': u'201149622', 'val': '116299.38'},
                    {'key': u'201148329', 'val': '40694.04'},
                    {'key': u'201145114', 'val': '111784.99'},
                    {'key': u'201149229', 'val': '111054.09'},
                    {'key': u'201149582', 'val': '115009.56'},
                    {'key': u'201149828', 'val': '52882.90'},
                    {'key': u'201149589', 'val': '85988.45'},
                    {'key': u'201148353', 'val': '65351.23'},
                    {'key': u'201145359', 'val': '120383.84'},
                    {'key': u'201149474', 'val': '130702.45'},
                    {'key': u'201148589', 'val': '173266.74'},
                    {'key': u'201149751', 'val': '344792.20'},
                    {'key': u'201149359', 'val': '103960.04'}],
                    [{'bid': u'7:30:12 AM 1104156'},
                    {'key': u'201149215', 'val': 0},
                    {'key': u'201149597', 'val': 0},
                    {'key': u'201149168', 'val': 0},
                    {'key': u'201148342', 'val': 0},
                    {'key': u'201149456', 'val': 0},
                    {'key': u'201147544', 'val': 0},
                    {'key': u'201148832', 'val': 0},
                    {'key': u'201148834', 'val': 0},
                    {'key': u'201149167', 'val': 0},
                    {'key': u'201149289', 'val': 0},
                    {'key': u'201149284', 'val': 0},
                    {'key': u'201150096', 'val': 0},
                    {'key': u'201149204', 'val': 0},
                    {'key': u'201149047', 'val': 0},
                    {'key': u'201147653', 'val': 0},
                    {'key': u'201149687', 'val': 0},
                    {'key': u'201149257', 'val': 0},
                    {'key': u'201149444', 'val': 0},
                    {'key': u'201150008', 'val': 0},
                    {'key': u'201149579', 'val': 0},
                    {'key': u'201148009', 'val': '70000.00'},
                    {'key': u'201149471', 'val': 0},
                    {'key': u'201149935', 'val': 0},
                    {'key': u'201149441', 'val': 0},
                    {'key': u'201149846', 'val': 0},
                    {'key': u'201149778', 'val': 0},
                    {'key': u'201149565', 'val': 0},
                    {'key': u'201149560', 'val': 0},
                    {'key': u'201149562', 'val': 0},
                    {'key': u'201148993', 'val': 0},
                    {'key': u'201146570', 'val': 0},
                    {'key': u'201147482', 'val': 0},
                    {'key': u'201149372', 'val': 0},
                    {'key': u'201149374', 'val': 0},
                    {'key': u'201149875', 'val': 0},
                    {'key': u'201149988', 'val': 0},
                    {'key': u'201149905', 'val': 0},
                    {'key': u'201145735', 'val': 0},
                    {'key': u'201149703', 'val': 0},
                    {'key': u'201149669', 'val': 0},
                    {'key': u'201149577', 'val': 0},
                    {'key': u'201148154', 'val': 0},
                    {'key': u'201149578', 'val': 0},
                    {'key': u'201149477', 'val': 0},
                    {'key': u'201149269', 'val': 0},
                    {'key': u'201149664', 'val': 0},
                    {'key': u'201149063', 'val': 0},
                    {'key': u'201144387', 'val': 0},
                    {'key': u'201149991', 'val': 0},
                    {'key': u'201147776', 'val': 0},
                    {'key': u'201149154', 'val': 0},
                    {'key': u'201149912', 'val': 0},
                    {'key': u'201149712', 'val': 0},
                    {'key': u'201148780', 'val': 0},
                    {'key': u'201149469', 'val': 0},
                    {'key': u'201149544', 'val': 0},
                    {'key': u'201149541', 'val': 0},
                    {'key': u'201149462', 'val': 0},
                    {'key': u'201149652', 'val': 0},
                    {'key': u'201149396', 'val': 0},
                    {'key': u'201149077', 'val': 0},
                    {'key': u'201149253', 'val': 0},
                    {'key': u'201148544', 'val': 0},
                    {'key': u'201145759', 'val': 0},
                    {'key': u'201148972', 'val': 0},
                    {'key': u'201148639', 'val': 0},
                    {'key': u'201148539', 'val': 0},
                    {'key': u'201149321', 'val': 0},
                    {'key': u'201149241', 'val': 0},
                    {'key': u'201148530', 'val': 0},
                    {'key': u'201148886', 'val': 0},
                    {'key': u'201149976', 'val': 0},
                    {'key': u'201145234', 'val': 0},
                    {'key': u'201150125', 'val': 0},
                    {'key': u'201147140', 'val': 0},
                    {'key': u'201147282', 'val': 0},
                    {'key': u'201149733', 'val': 0},
                    {'key': u'201146741', 'val': 0},
                    {'key': u'201150040', 'val': 0},
                    {'key': u'201148440', 'val': 0},
                    {'key': u'201149336', 'val': 0},
                    {'key': u'201144944', 'val': 0},
                    {'key': u'201147471', 'val': 0},
                    {'key': u'201148956', 'val': 0},
                    {'key': u'201149534', 'val': 0},
                    {'key': u'201149741', 'val': 0},
                    {'key': u'201149940', 'val': 0},
                    {'key': u'201149622', 'val': 0},
                    {'key': u'201148329', 'val': 0},
                    {'key': u'201145114', 'val': 0},
                    {'key': u'201149229', 'val': 0},
                    {'key': u'201149582', 'val': 0},
                    {'key': u'201149828', 'val': 0},
                    {'key': u'201149589', 'val': 0},
                    {'key': u'201148353', 'val': 0},
                    {'key': u'201145359', 'val': 0},
                    {'key': u'201149474', 'val': 0},
                    {'key': u'201148589', 'val': 0},
                    {'key': u'201149751', 'val': 0},
                    {'key': u'201149359', 'val': 0}],
                    [{'bid': u'7:15:48 PM  1104139'},
                    {'key': u'201149215', 'val': '3198.50'},
                    {'key': u'201149597', 'val': '1673.37'},
                    {'key': u'201149168', 'val': '690.47'},
                    {'key': u'201148342', 'val': '1852.08'},
                    {'key': u'201149456', 'val': '1397.19'},
                    {'key': u'201147544', 'val': '2361.41'},
                    {'key': u'201148832', 'val': '4242.48'},
                    {'key': u'201148834', 'val': '1852.08'},
                    {'key': u'201149167', 'val': '1145.37'},
                    {'key': u'201149289', 'val': '2680.65'},
                    {'key': u'201149284', 'val': '1722.11'},
                    {'key': u'201150096', 'val': '1348.45'},
                    {'key': u'201149204', 'val': '2534.43'},
                    {'key': u'201149047', 'val': '1608.39'},
                    {'key': u'201147653', 'val': '2550.68'},
                    {'key': u'201149687', 'val': '3265.52'},
                    {'key': u'201149257', 'val': '1421.56'},
                    {'key': u'201149444', 'val': '5081.04'},
                    {'key': u'201150008', 'val': '1868.33'},
                    {'key': u'201149579', 'val': '8301.88'},
                    {'key': u'201148009', 'val': '2274.49'},
                    {'key': u'201149471', 'val': '1449.99'},
                    {'key': u'201149935', 'val': '1754.61'},
                    {'key': u'201149441', 'val': '1502.79'},
                    {'key': u'201149846', 'val': '3249.27'},
                    {'key': u'201149778', 'val': '812.32'},
                    {'key': u'201149565', 'val': '2680.65'},
                    {'key': u'201149560', 'val': '1949.56'},
                    {'key': u'201149562', 'val': '10153.96'},
                    {'key': u'201148993', 'val': '4094.08'},
                    {'key': u'201146570', 'val': '3720.41'},
                    {'key': u'201147482', 'val': '3387.36'},
                    {'key': u'201149372', 'val': '3330.50'},
                    {'key': u'201149374', 'val': '2376.64'},
                    {'key': u'201149875', 'val': '3277.70'},
                    {'key': u'201149988', 'val': '1762.73'},
                    {'key': u'201149905', 'val': '1631.95'},
                    {'key': u'201145735', 'val': '2071.41'},
                    {'key': u'201149703', 'val': '5004.69'},
                    {'key': u'201149669', 'val': '1637.63'},
                    {'key': u'201149577', 'val': '1031.64'},
                    {'key': u'201148154', 'val': '2193.26'},
                    {'key': u'201149578', 'val': '7006.24'},
                    {'key': u'201149477', 'val': '4750.35'},
                    {'key': u'201149269', 'val': '1108.41'},
                    {'key': u'201149664', 'val': '2288.08'},
                    {'key': u'201149063', 'val': '1811.47'},
                    {'key': u'201144387', 'val': '3317.32'},
                    {'key': u'201149991', 'val': '1299.71'},
                    {'key': u'201147776', 'val': '2657.90'},
                    {'key': u'201149154', 'val': '2177.01'},
                    {'key': u'201149912', 'val': '1884.58'},
                    {'key': u'201149712', 'val': '1098.25'},
                    {'key': u'201148780', 'val': '2396.34'},
                    {'key': u'201149469', 'val': '1892.70'},
                    {'key': u'201149544', 'val': '2599.41'},
                    {'key': u'201149541', 'val': '2030.79'},
                    {'key': u'201149462', 'val': '3942.18'},
                    {'key': u'201149652', 'val': '2018.89'},
                    {'key': u'201149396', 'val': '1452.42'},
                    {'key': u'201149077', 'val': '1788.18'},
                    {'key': u'201149253', 'val': '2144.52'},
                    {'key': u'201148544', 'val': '2079.53'},
                    {'key': u'201145759', 'val': '3387.36'},
                    {'key': u'201148972', 'val': '2112.02'},
                    {'key': u'201148639', 'val': '1535.28'},
                    {'key': u'201148539', 'val': '2850.21'},
                    {'key': u'201149321', 'val': '1527.16'},
                    {'key': u'201149241', 'val': '2388.21'},
                    {'key': u'201148530', 'val': '1831.78'},
                    {'key': u'201148886', 'val': '1957.68'},
                    {'key': u'201149976', 'val': '812.32'},
                    {'key': u'201145234', 'val': '5081.04'},
                    {'key': u'201150125', 'val': '3200.53'},
                    {'key': u'201147140', 'val': '1196.14'},
                    {'key': u'201147282', 'val': '3886.99'},
                    {'key': u'201149733', 'val': '2355.72'},
                    {'key': u'201146741', 'val': '2030.79'},
                    {'key': u'201150040', 'val': '2973.08'},
                    {'key': u'201148440', 'val': '3046.19'},
                    {'key': u'201149336', 'val': '779.82'},
                    {'key': u'201144944', 'val': '2924.34'},
                    {'key': u'201147471', 'val': '2445.07'},
                    {'key': u'201148956', 'val': '324.93'},
                    {'key': u'201149534', 'val': '1502.79'},
                    {'key': u'201149741', 'val': '3387.36'},
                    {'key': u'201149940', 'val': '2871.31'},
                    {'key': u'201149622', 'val': '2197.32'},
                    {'key': u'201148329', 'val': '768.86'},
                    {'key': u'201145114', 'val': '2112.02'},
                    {'key': u'201149229', 'val': '2098.22'},
                    {'key': u'201149582', 'val': '2172.95'},
                    {'key': u'201149828', 'val': '999.15'},
                    {'key': u'201149589', 'val': '1624.63'},
                    {'key': u'201148353', 'val': '1234.72'},
                    {'key': u'201145359', 'val': '2274.49'},
                    {'key': u'201149474', 'val': '2469.44'},
                    {'key': u'201148589', 'val': '3273.64'},
                    {'key': u'201149751', 'val': '6514.38'},
                    {'key': u'201149359', 'val': '1964.18'}],
                    [{'bid': u'5:06:12 PM 1104136'},
                    {'key': u'201149215', 'val': 0},
                    {'key': u'201149597', 'val': 0},
                    {'key': u'201149168', 'val': 0},
                    {'key': u'201148342', 'val': 0},
                    {'key': u'201149456', 'val': 0},
                    {'key': u'201147544', 'val': 0},
                    {'key': u'201148832', 'val': 0},
                    {'key': u'201148834', 'val': 0},
                    {'key': u'201149167', 'val': 0},
                    {'key': u'201149289', 'val': 0},
                    {'key': u'201149284', 'val': 0},
                    {'key': u'201150096', 'val': 0},
                    {'key': u'201149204', 'val': 0},
                    {'key': u'201149047', 'val': 0},
                    {'key': u'201147653', 'val': 0},
                    {'key': u'201149687', 'val': 0},
                    {'key': u'201149257', 'val': 0},
                    {'key': u'201149444', 'val': 0},
                    {'key': u'201150008', 'val': 0},
                    {'key': u'201149579', 'val': 0},
                    {'key': u'201148009', 'val': 0},
                    {'key': u'201149471', 'val': 0},
                    {'key': u'201149935', 'val': 0},
                    {'key': u'201149441', 'val': 0},
                    {'key': u'201149846', 'val': 0},
                    {'key': u'201149778', 'val': 0},
                    {'key': u'201149565', 'val': 0},
                    {'key': u'201149560', 'val': 0},
                    {'key': u'201149562', 'val': 0},
                    {'key': u'201148993', 'val': 0},
                    {'key': u'201146570', 'val': 0},
                    {'key': u'201147482', 'val': 0},
                    {'key': u'201149372', 'val': 0},
                    {'key': u'201149374', 'val': 0},
                    {'key': u'201149875', 'val': 0},
                    {'key': u'201149988', 'val': 0},
                    {'key': u'201149905', 'val': 0},
                    {'key': u'201145735', 'val': 0},
                    {'key': u'201149703', 'val': 0},
                    {'key': u'201149669', 'val': '100800.00'},
                    {'key': u'201149577', 'val': 0},
                    {'key': u'201148154', 'val': 0},
                    {'key': u'201149578', 'val': 0},
                    {'key': u'201149477', 'val': 0},
                    {'key': u'201149269', 'val': 0},
                    {'key': u'201149664', 'val': 0},
                    {'key': u'201149063', 'val': 0},
                    {'key': u'201144387', 'val': 0},
                    {'key': u'201149991', 'val': 0},
                    {'key': u'201147776', 'val': 0},
                    {'key': u'201149154', 'val': 0},
                    {'key': u'201149912', 'val': 0},
                    {'key': u'201149712', 'val': 0},
                    {'key': u'201148780', 'val': 0},
                    {'key': u'201149469', 'val': 0},
                    {'key': u'201149544', 'val': 0},
                    {'key': u'201149541', 'val': 0},
                    {'key': u'201149462', 'val': 0},
                    {'key': u'201149652', 'val': 0},
                    {'key': u'201149396', 'val': 0},
                    {'key': u'201149077', 'val': 0},
                    {'key': u'201149253', 'val': 0},
                    {'key': u'201148544', 'val': 0},
                    {'key': u'201145759', 'val': 0},
                    {'key': u'201148972', 'val': 0},
                    {'key': u'201148639', 'val': 0},
                    {'key': u'201148539', 'val': 0},
                    {'key': u'201149321', 'val': 0},
                    {'key': u'201149241', 'val': 0},
                    {'key': u'201148530', 'val': 0},
                    {'key': u'201148886', 'val': 0},
                    {'key': u'201149976', 'val': 0},
                    {'key': u'201145234', 'val': 0},
                    {'key': u'201150125', 'val': 0},
                    {'key': u'201147140', 'val': 0},
                    {'key': u'201147282', 'val': 0},
                    {'key': u'201149733', 'val': 0},
                    {'key': u'201146741', 'val': 0},
                    {'key': u'201150040', 'val': 0},
                    {'key': u'201148440', 'val': 0},
                    {'key': u'201149336', 'val': 0},
                    {'key': u'201144944', 'val': 0},
                    {'key': u'201147471', 'val': 0},
                    {'key': u'201148956', 'val': 0},
                    {'key': u'201149534', 'val': 0},
                    {'key': u'201149741', 'val': 0},
                    {'key': u'201149940', 'val': 0},
                    {'key': u'201149622', 'val': 0},
                    {'key': u'201148329', 'val': 0},
                    {'key': u'201145114', 'val': 0},
                    {'key': u'201149229', 'val': 0},
                    {'key': u'201149582', 'val': 0},
                    {'key': u'201149828', 'val': 0},
                    {'key': u'201149589', 'val': 0},
                    {'key': u'201148353', 'val': 0},
                    {'key': u'201145359', 'val': 0},
                    {'key': u'201149474', 'val': 0},
                    {'key': u'201148589', 'val': 0},
                    {'key': u'201149751', 'val': 0},
                    {'key': u'201149359', 'val': 0}]]
            self.response.out.write(template.render("templates/results.html",
                    parameters))
            #TODO remove the previous lines and replace with the oops to
            # best practices accomplishment
            #self.response.out.write(template.render("templates/oops.html",
            #        []))


class MyBids(webapp.RequestHandler):
    @PageAllowed(['Admin', 'Broker', 'MO', 'Engine'])
    def get(self):
        page = Page.MYBIDS
        parameters = getPageDict(page)
        parameters['User'] = "%s %s" % (getCurrentUser(), getGroup())
        self.response.out.write(template.render("templates/mybids.html",
                parameters))


class ManUsers(webapp.RequestHandler):
    @PageAllowed(['Admin', 'Broker'])
    def get(self):
        page = Page.USERS
        parameters = getPageDict(page)
        parameters['User'] = "%s %s" % (getCurrentUser(), getGroup())
        self.response.out.write(template.render("templates/users.html",
                parameters))


#Storage of the dojo bids json
dojoAjaxKey = 'bids'


# TODO add decorator
class BidsRest(webapp.RequestHandler):
    def post(self):
        bidsToAddJson = self.request.get(dojoAjaxKey)
        bidsToAddObj = json.loads(bidsToAddJson)
        # Adding the bid model objects
        dbUser = getTheUser(users.get_current_user())
        # Getting the bids for the current user
        userBids = dbUser.bids
        currentBids = {}
        #TODO if the user is an admin, then add all the bids
        #TODO if the user is a MO, the add the users for the MO
        i = 0 
        for bid in userBids:
            if bid.loan:
                currentBids[bid.loan.collateral_key] = bid
            else:
                currentBids[i] = bid
                i += 1
               
        currentBidsKeys = currentBids.keys()
        # Adding or updating the bids
        statusChoices = Bid.status.choices
        creationTime = datetime.now()
        expirationTime = creationTime + timedelta(hours=2)
        for key, value in bidsToAddObj.iteritems():
            # Getting user input values
            participation = float(value['participation'])
            bidrate = float(value['bidrate'])
            # Checking if there is a bid for a given collateral key
            if (key in currentBidsKeys):
                bid = currentBids[key]
                bid.participation = participation
                bid.bidrate = bidrate
                bid.put()
            else:
                loanQuery = loansModel.loansModel.all(). \
                        filter('collateral_key =', key)
                loan = loanQuery.get()
                #TODO check why the status is random?
                #status = random.choice(statusChoices)
                status = 'Active'
                Bid(parent = dbUser,
                        user = dbUser,
                        loan = loan,
                        participation = participation,
                        bidrate = bidrate,
                        #TODO add the posibility of get a None value in
                        # bidrate, it is in the myscript.js
                        ordertype = 'Noncompetitive' if bidrate else
                                'Competitive',
                        status = status,
                        createdAt = creationTime,
                        expiresAt = expirationTime,
                        #Added to agree with the LiqSpop engine
                        #TODO is better to put it on the web
                        bidtype = 'Specified',
                        lorm = 'Loan',
                        ordertiming = 'Day Trade',
                        key_name = "%s %s" % (getCurrentUser(),
                            creationTime),
                    ).put()

    def get(self):
        # Getting bids from the Db
        bidsModelObj = []
        modelBids = getTheUser(users.get_current_user()).bids
        #TODO add the new fields
        for modelBid in modelBids:
            bidModelObj = {}
            if modelBid.loan:
                bidModelObj['collateral_key'] = modelBid.loan.collateral_key
            else:
                bidModelObj['collateral_key'] = ""
            bidModelObj['participation'] = modelBid.participation
            bidModelObj['bidrate'] = modelBid.bidrate
            bidModelObj['status'] = modelBid.status
            bidModelObj['createdAt'] = modelBid.createdAt. \
                    strftime('%Y/%m/%d %H:%M:%S')
            bidModelObj['expiresAt'] = modelBid.expiresAt. \
                    strftime('%Y/%m/%d %H:%M:%S')
            bidsModelObj.append(bidModelObj)
        # Wrapping and sending
        itemsWrapper = {}
        itemsWrapper['items'] = bidsModelObj
        bidsToSendJson = json.dumps(itemsWrapper)
        self.response.headers['Content-Type'] = 'application/json'
        self.response.out.write(bidsToSendJson)

    def delete(self):
        bidsToDeleteJson = self.request.get(dojoAjaxKey)
        bidsToDeleteObj = json.loads(bidsToDeleteJson)
        userBids = getTheUser(users.get_current_user()).bids
        currentBids = {}
        for bid in userBids:
            currentBids[bid.loan.collateral_key] = bid
        currentBidsKeys = currentBids.keys()
        # Deleting bid model
        for key in bidsToDeleteObj.iterkeys():
            if(key in currentBidsKeys):
                currentBids.pop(key).delete()
                currentBidsKeys = currentBids.keys()


#Storage of the dojo bids json
dojoAjaxKey = 'bids'


class UsersRest(webapp.RequestHandler):
    #def post(self):
    #    usersToAddJson = self.request.get(dojoAjaxKey)
    #    usersToAddObj =  json.loads(usersToAddJson)
    #    # Adding the bid model objects
    #    ##dbUser = getTheUser(users.get_current_user())
    #    # Getting the bids for the current user
    #    userBids = dbUser.bids
    #    currentBids = {}
    #    for bid in userBids:
    #        currentBids[bid.loan.collateral_key] = bid
    #    currentBidsKeys = currentBids.keys()
    #    # Adding or updating the bids
    #    statusChoices = Bid.status.choices
    #    creationTime = datetime.now()
    #    expirationTime = creationTime + timedelta(hours=2)
    #    for key, value in usersToAddObj.iteritems():
    #        # Getting user input values
    #        participation = float(value['participation'])
    #        bidrate = float(value['bidrate'])
    #        # Checking if there is a bid for a given collateral key
    #        if (key in currentBidsKeys):
    #            bid = currentBids[key]
    #            bid.participation = participation
    #            bid.bidrate = bidrate
    #            bid.put()
    #        else:
    #            loanQuery = loansModel.loansModel.all().
    #                    filter('collateral_key =', key)
    #            loan = loanQuery.get()
    #            #TODO check why the status is random?
    #            #status = random.choice(statusChoices)
    #            status = 'Active'
    #            Bid(parent = dbUser,
    #                      user = dbUser,
    #                      loan = loan,
    #                      participation = participation,
    #                      bidrate = bidrate,
    #                      #TODO add the posibility of get a None value in
    #                      # bidrate, it is in the myscript.js
    #                      ordertype = 'Competitive' if bidrate !=
    #                               None else 'Noncompetitive',
    #                      status = status,
    #                      createdAt = creationTime,
    #                      expiresAt = expirationTime,
    #                      #Added to agree with the LiqSpop engine
    #                      #TODO is better to put it on the web
    #                      bidtype = 'Specified',
    #                      lorm = 'Loan',
    #                      ordertiming = 'Day Trade',
    #                      key_name = "%s %s"%(getCurrentUser(),
    #                              creationTime),
    #                      ).put()

    def get(self):
        # Getting Users from the Db
        usersModelObj = []
        modelUsers = User.all()
        for modelUser in modelUsers:
            userModelObj = {}
            userModelObj['account'] = str(modelUser.account)
            userModelObj['fundsAvailable'] = modelUser.fundsAvailable if \
                    modelUser.group == 'Broker' else '*****'
            userModelObj['group'] = modelUser.group
            usersModelObj.append(userModelObj)
        # Wrapping and sending
        itemsWrapper = {}
        itemsWrapper['items'] = usersModelObj
        usersToSendJson = json.dumps(itemsWrapper)
        self.response.headers['Content-Type'] = 'application/json'
        self.response.out.write(usersToSendJson)

    #def delete(self):
    #    bidsToDeleteJson = self.request.get(dojoAjaxKey)
    #    bidsToDeleteObj =  json.loads(bidsToDeleteJson)
    #    userBids = getTheUser(users.get_current_user()).bids
    #    currentBids = {}
    #    for bid in userBids:
    #        currentBids[bid.loan.collateral_key] = bid
    #    currentBidsKeys = currentBids.keys()
    #    # Deleting bid model
    #    for key in bidsToDeleteObj.iterkeys():
    #        if(key in currentBidsKeys):
    #            currentBids.pop(key).delete()
    #            currentBidsKeys = currentBids.keys()


class jsonLoans(webapp.RequestHandler):
    def get(self):
        bidsToSendJson = memcache.get("bidsToSendJson")
        if bidsToSendJson is None:
            bidsToSendJson = self.generateLoans()
            if not memcache.add("bidsToSendJson", bidsToSendJson, 3600):
                logging.error("Memcache set failed.")
        self.response.headers['Content-Type'] = 'application/json'
        self.response.out.write(bidsToSendJson)

    def generateLoans(self):
        loanJsonObj = []
        datetypeObj = date.today()
        nonetypeObj = None
        loans = loansModel.loansModel.all()
        for loan in loans:
            loanObj = {}
            for k, v in vars(loan).items():
                k = k[1:]
                if k != 'entity' and k != 'from_entity':
                    if type(v) == type(datetypeObj):
                        loanObj[k] = '{0}/{1}/{2}'.format(v.month, v.day,
                                v.year)
                            # strftime('%m/%d/%Y')
                    elif type(v) == bool:
                        loanObj[k] = 1 if v else 0
                    elif type(v) == type(nonetypeObj):
                        loanObj[k] = ''
                    else:
                        loanObj[k] = v
#                    self.response.out.write('{0}({1}) {2}\n'.
#                            format(k,type(loanObj[k]),loanObj[k]))
#            self.response.out.write('\n\n')
            loanJsonObj.append(loanObj)
        itemsWrapper = {}
        itemsWrapper['items'] = loanJsonObj
        return json.dumps(itemsWrapper)


class Login(webapp.RequestHandler):
    @PageAllowed(['Admin', 'Broker', 'MO', 'Engine'])
    def get(self):
        self.redirect('/home')


class TestingInstance(webapp.RequestHandler):
    def get(self):
        user.UserInstance().get()
        loansModel.loansModelInstance().get()


class TestingLoans(webapp.RequestHandler):
    def get(self):
        loansModel.loansModelInstance().get()
        

class TestingBids(webapp.RequestHandler):
    def get(self):
        bid.BidsInstance().get()


class Logout(webapp.RequestHandler):
    def get(self):
        self.redirect(users.create_logout_url('/'))


def jsonToCsv(jsonStr):
    rows = json.loads(jsonStr)
    csvOut = StringIO.StringIO()
    if rows is not None:
        writer = csv.writer(csvOut)
        writer.writerows(rows)
    csvStr = csvOut.getvalue()
    csvOut.close()
    return csvStr


class Download(webapp.RequestHandler):
    def post(self):
        self.response.headers['Content-Type'] = 'application/octet-stream'
        self.response.headers['Content-Disposition'] = \
                'attachment;filename=\"Loans Details.csv\"'
        bidsJson = self.request.get(dojoAjaxKey)
        bidsCsv = jsonToCsv(bidsJson)
        self.response.out.write(bidsCsv)


class Labels(webapp.RequestHandler):
    def get(self):
        fieldToLabelDict = {}
        # models where the labels are defined as verbose names
        models = [loansModel.loansModel, Bid]
        for model in models:
            fieldToLabelDict.update(
                    self.getModelPropertiesFieldToVerboseNameDict(model))
        self.response.headers['Content-Type'] = 'application/json'
        self.response.out.write(json.dumps(fieldToLabelDict))

    def getModelPropertiesFieldToVerboseNameDict(self, model):
        propertiesFieldToVerboseNamesDict = {}
        for field, modelProperty in model.properties().iteritems():
            propertiesFieldToVerboseNamesDict[field] = \
                    modelProperty.verbose_name
        return propertiesFieldToVerboseNamesDict


class BidWindow():
    class Bids(webapp.RequestHandler):
        def get(self):
            bidsObj = {}
            for bid in Bid.all():
                bidObj = {}
                # Extracting properties
                bidId = bid.key().id_or_name()
                time = bid.createdAt.strftime("%H:%M:%S")
                date = bid.createdAt.strftime("%Y-%m-%d")
                participation = bid.participation
                loanId = bid.loan.key().id_or_name()
                bidRate = bid.bidrate
                if bidRate > 0:
                    orderType = 'Competitive'
                else:
                    orderType = 'Noncompetitive'
                userId = bid.user.key().id_or_name()
                # Passing properties to the obj
                bidObj['bidId'] = bidId
                bidObj['date'] = date
                bidObj['time'] = time
                bidObj['bidType'] = 'Specified'
                bidObj['participation'] = participation
                bidObj['assetSubset'] = 'Loan'
                bidObj['loanId'] = loanId
                bidObj['orderType'] = orderType
                if (orderType == 'Competitive'):
                    bidObj['bidRate'] = bidRate
                bidObj['orderTiming'] = 'Day Trade'
                bidObj['userId'] = userId
                # Inserting new object into the accumulation object
                bidsObj[bidId] = bidObj
            # Dumping to JSON the accumulation object
            self.response.headers['Content-Type'] = 'application/json'
            self.response.out.write(json.dumps(bidsObj))

    class Loans(webapp.RequestHandler):
        def get(self):
            loansObj = {}
            for bid in Bid.all():
                loan = bid.loan
                loanId = loan.key().id_or_name()
                if (loanId not in loansObj):
                    loanObj = {}
                    # Extracting properties
                    mo = loan.customer_account_key
                    loanAmount = loan.curr_upb
                    # Passing properties to the obj
                    loanObj['loanId'] = loanId
                    loanObj['mortgageOriginator'] = mo
                    loanObj['loanAmount'] = loanAmount
                    # Inserting new object into the accumulation object
                    loansObj[loanId] = loanObj
            # Dumping to JSON the accumulation object
            self.response.headers['Content-Type'] = 'application/json'
            self.response.out.write(json.dumps(loansObj))

    class Users(webapp.RequestHandler):
        def get(self):
            usersObj = {}
            for bid in Bid.all():
                user = bid.user
                userId = user.key().id_or_name()
                if (userId not in usersObj):
                    userObj = {}
                    # Extracting properties
                    fundsAvailable = user.fundsAvailable
                    # Passing properties to the obj
                    userObj['userId'] = userId
                    userObj['fundsAvailable'] = fundsAvailable
                    # Inserting new object into the accumulation object
                    usersObj[userId] = userObj
            # Dumping to JSON the accumulation object
            self.response.headers['Content-Type'] = 'application/json'
            self.response.out.write(json.dumps(usersObj))

#################################################################

#TODO add groups grand to the urls
application = webapp.WSGIApplication(
                                     [('/mybids', MyBids),
                                      ('/bidWindow/bids', BidWindow.Bids),
                                      ('/bidWindow/loans', BidWindow.Loans),
                                      ('/bidWindow/users', BidWindow.Users),
                                      ('/bids', BidsRest),
                                      ('/users', UsersRest),
                                      ('/manusers', ManUsers),
                                      ('/home', Home),
                                      ('/logout', Logout),
                                      ('/search', Search),
                                      ('/calc', Calc),
                                      ('/download', Download),
                                      ('/jsonLoans', jsonLoans),
                                      ('/DataTesting', TestingInstance),
                                      ('/LoanTesting', TestingLoans),
                                      ('/BidTesting', TestingBids),
                                      ('/jsonDelete', loansModel.jsonDelete),
                                      ('/labels', Labels),
                                      ('/', Login)
                                     ],
                                     debug=True)


def main():
    run_wsgi_app(application)

if __name__ == "__main__":
    main()
